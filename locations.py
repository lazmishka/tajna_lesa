import random
from typing import Optional, Dict, List, Tuple
from dataclasses import dataclass

from core import Item
from heroes import Hero, Ivan, Vasilisa, Sluga
from enemies import (
    Vodyanoy, SoloveyRazboynik, BabaYaga, Leshy, ShadowKoschei, Upyr
)
from battle import battle, boss_battle
from game_state import game_manager, get_input_with_menu


@dataclass
class LocationResult:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–µ—â–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏."""
    next_location: str = ""
    game_over: bool = False
    victory: bool = False
    path_taken: str = ""
    reload_location: bool = False  # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é


def show_choice(text: str, options: List[str], max_choice: int = None) -> int:
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä –∏ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–Ω—é (0)."""
    if max_choice is None:
        max_choice = len(options)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∏ –æ–ø—Ü–∏–∏
    if text:
        print(text)
    
    options_list = []
    for opt in options:
        print(opt)
        options_list.append(opt)
    
    return get_input_with_menu(
        f"\n  –í—ã–±–æ—Ä (1-{max_choice}): ", 
        range(1, max_choice + 1),
        text,
        options_list
    )


def show_navigation(current: str, available: List[Tuple[str, str, str]]) -> str:
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID —Å–ª–µ–¥—É—é—â–µ–π –ª–æ–∫–∞—Ü–∏–∏."""
    header = "\n  üß≠ –ö–£–î–ê –ù–ê–ü–†–ê–í–ò–¢–¨–°–Ø?"
    print(header)
    
    options = []
    for i, (loc_id, name, desc) in enumerate(available, 1):
        opt_text = f"\n  {i}. {name}\n     {desc}"
        print(opt_text)
        options.append(opt_text)
    
    choice = get_input_with_menu(
        f"\n  –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (1-{len(available)}): ",
        range(1, len(available) + 1),
        header,
        options
    )
    
    return available[choice - 1][0]


class Location:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ª–æ–∫–∞—Ü–∏–∏."""
    
    def __init__(self, loc_id: str, name: str, first_visit_desc: str, revisit_desc: str):
        self.id = loc_id
        self.name = name
        self.first_visit_desc = first_visit_desc
        self.revisit_desc = revisit_desc
    
    def get_description(self, hero: Hero) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è."""
        if hero.has_visited(self.id):
            return self.revisit_desc
        return self.first_visit_desc
    
    def enter(self, hero: Hero) -> LocationResult:
        # –°–ù–ê–ß–ê–õ–ê –ø–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–æ –æ—Ç–º–µ—Ç–∫–∏ –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏!)
        description = self.get_description(hero)
        
        # –ü–û–¢–û–ú –æ—Ç–º–µ—á–∞–µ–º –ø–æ—Å–µ—â–µ–Ω–∏–µ
        hero.visit_location(self.id)
        
        print(f"\n{'‚ïê' * 60}")
        print(f"\n  üìç {self.name}")
        print(f"\n{'‚ïê' * 60}")
        print(description)
        
        return LocationResult()


class Opushka(Location):
    """–û–ø—É—à–∫–∞ –ª–µ—Å–∞ - –Ω–∞—á–∞–ª–æ –∏ —Ä–∞–∑–≤–∏–ª–∫–∞."""
    
    def __init__(self):
        super().__init__(
            "opushka",
            "üå≤ –û–ü–£–®–ö–ê –ó–ê–ü–û–í–ï–î–ù–û–ì–û –õ–ï–°–ê",
            """
    –¢—ã —Å—Ç–æ–∏—à—å –Ω–∞ –æ–ø—É—à–∫–µ –¥—Ä–µ–≤–Ω–µ–≥–æ –ª–µ—Å–∞. –í–µ–∫–æ–≤—ã–µ –¥—É–±—ã 
    —Å–º—ã–∫–∞—é—Ç –∫—Ä–æ–Ω—ã –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π, –ø–æ—á—Ç–∏ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—è —Å–≤–µ—Ç.
    –í–æ–∑–¥—É—Ö –ø–∞—Ö–Ω–µ—Ç –ø—Ä–µ–ª–æ–π –ª–∏—Å—Ç–≤–æ–π –∏ —á–µ–º-—Ç–æ... –≤–æ–ª—à–µ–±–Ω—ã–º.
    
    –£ —Ä–∞–∑–≤–∏–ª–∫–∏ —Å—Ç–æ–∏—Ç –∑–∞–º—à–µ–ª—ã–π –∫–∞–º–µ–Ω—å —Å –Ω–∞–¥–ø–∏—Å—å—é:
    
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë  ¬´–ù–∞–ª–µ–≤–æ –ø–æ–π–¥—ë—à—å ‚Äî –≤–æ–¥—É –Ω–∞–π–¥—ë—à—å.      ‚ïë
    ‚ïë   –ü—Ä—è–º–æ –ø–æ–π–¥—ë—à—å ‚Äî –≤ –¥—ã–º –ø–æ–ø–∞–¥—ë—à—å.     ‚ïë
    ‚ïë   –ù–∞–ø—Ä–∞–≤–æ –ø–æ–π–¥—ë—à—å ‚Äî –≤–æ —Ç—å–º—É —É–π–¥—ë—à—å.¬ª  ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    
    –ù–∞ –∑–µ–º–ª–µ –≤–∏–¥–Ω—ã —Å–ª–µ–¥—ã ‚Äî –∫—Ç–æ-—Ç–æ –ø—Ä–æ—à—ë–ª –∑–¥–µ—Å—å –Ω–µ–¥–∞–≤–Ω–æ.
    –ú–µ–∂ –∫–æ—Ä–Ω–µ–π –¥—É–±–∞ —á—Ç–æ-—Ç–æ –±–ª–µ—Å—Ç–∏—Ç...
""",
            """
    –ó–Ω–∞–∫–æ–º–∞—è —Ä–∞–∑–≤–∏–ª–∫–∞. –ö–∞–º–µ–Ω—å —Å –Ω–∞–¥–ø–∏—Å—å—é –≤—Å—ë —Ç–∞–∫ –∂–µ
    —Å—Ç–æ–∏—Ç —É —Ç—Ä–æ–ø—ã. –õ–µ—Å —à—É–º–∏—Ç –ª–∏—Å—Ç–≤–æ–π, —Å–ª–æ–≤–Ω–æ —à–µ–ø—á–µ—Ç 
    —á—Ç–æ-—Ç–æ –Ω–∞ –∑–∞–±—ã—Ç–æ–º —è–∑—ã–∫–µ.
    
    –¢—Ä–æ–ø—ã –≤–µ–¥—É—Ç –≤ —Ä–∞–∑–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã ‚Äî –∫—É–¥–∞ —Ç–µ–ø–µ—Ä—å?
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ –≤—ã–∑–æ–≤–∞ super() –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–º–µ—Ç–∏—Ç –ø–æ—Å–µ—â–µ–Ω–∏–µ
        first_time = not hero.has_visited(self.id)
        result = super().enter(hero)
        
        # –û—Å–º–æ—Ç—Ä –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
        if first_time:
            print("\n  üëÅÔ∏è –¢—ã –∑–∞–º–µ—á–∞–µ—à—å:")
            print("    ‚Ä¢ –°–ª–µ–≤–∞ —Å–ª—ã—à–µ–Ω –ø–ª–µ—Å–∫ –≤–æ–¥—ã")
            print("    ‚Ä¢ –ü—Ä—è–º–æ –≤–∏–¥–µ–Ω –¥—ã–º–æ–∫ –Ω–∞–¥ –¥–µ—Ä–µ–≤—å—è–º–∏")
            print("    ‚Ä¢ –°–ø—Ä–∞–≤–∞ –ª–µ—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥—É—â–µ –∏ —Ç–µ–º–Ω–µ–µ")
            
            if isinstance(hero, Sluga):
                print("    ‚Ä¢ –í —Ç–µ–Ω—è—Ö –º–µ—Ä—Ü–∞–µ—Ç —á—Ç–æ-—Ç–æ –∑–Ω–∞–∫–æ–º–æ–µ...")
        
        # –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏
        print("\n  ‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å?")
        options = [
            "\n  1. üîç –û—Å–º–æ—Ç—Ä–µ—Ç—å –±–ª–µ—Å–∫ —É –∫–æ—Ä–Ω–µ–π",
            "  2. üìñ –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∫–∞–º–µ–Ω—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ", 
            "  3. üö∂ –ò–¥—Ç–∏ –¥–∞–ª—å—à–µ"
        ]
        
        choice = show_choice("", options, 3)
        
        if choice == 1:
            if not hero.get_flag("opushka_searched"):
                hero.set_flag("opushka_searched", True)
                print("\n  –¢—ã —Ä–∞–∑–¥–≤–∏–≥–∞–µ—à—å —Ç—Ä–∞–≤—É —É –∫–æ—Ä–Ω–µ–π...")
                print("  –ù–∞—Ö–æ–¥–∏—à—å —Å—Ç–∞—Ä—É—é –º–æ–Ω–µ—Ç—É! –ë–µ—Å–ø–æ–ª–µ–∑–Ω–∞—è, –Ω–æ –∫—Ä–∞—Å–∏–≤–∞—è.")
                print("  –ü–æ–¥ –ª–∏—Å—Ç—å—è–º–∏ ‚Äî –≥—Ä–∏–±—ã. –ú–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è?")
                
                # –ù–µ–±–æ–ª—å—à–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
                if random.random() < 0.5:
                    hero.add_item(Item("üçÑ –õ–µ—Å–Ω—ã–µ –≥—Ä–∏–±—ã", "–ú–æ–∂–Ω–æ —Å—ä–µ—Å—Ç—å –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ –ª–µ—á–µ–Ω–∏—è", "heal", hp_restore=15))
                    print("\n" + hero.inventory[-1].name + " –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!")
            else:
                print("\n  –¢—ã —É–∂–µ –æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª –∑–¥–µ—Å—å. –ù–∏—á–µ–≥–æ –Ω–æ–≤–æ–≥–æ.")
        
        elif choice == 2:
            print("\n  –¢—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∞–µ—à—å –∫–∞–º–µ–Ω—å...")
            print("  –ü–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–¥–ø–∏—Å—å—é ‚Äî –µ—â—ë —Å—Ç—Ä–æ–∫–∏, –ø–æ—á—Ç–∏ —Å—Ç—ë—Ä—Ç—ã–µ:")
            print("  ¬´...–∞ –∫—Ç–æ —Ö–∏—Ç—ë—Ä –¥–∞ —Å–º–µ–ª, —Ç–æ—Ç –∏ —Ç–∞–π–Ω—ã–π –ø—É—Ç—å –æ–¥–æ–ª–µ–ª¬ª")
            
            if isinstance(hero, Sluga):
                print("\n  üíç –ü–µ—Ä—Å—Ç–µ–Ω—å –Ω–∞ –ø–∞–ª—å—Ü–µ —Ö–æ–ª–æ–¥–µ–µ—Ç.")
                print("  –¢—ã –∑–Ω–∞–µ—à—å —ç—Ç–æ—Ç –ø—É—Ç—å. –ö–æ—â–µ–π –≤–æ–¥–∏–ª —Ç–µ–±—è –∏–º.")
        
        # –í—ã–±–æ—Ä –ø—É—Ç–∏
        print("\n" + "‚îÄ" * 50)
        print("\n  üß≠ –í–´–ë–û–† –ü–£–¢–ò:")
        
        paths = [
            ("omut", "üíß –ù–∞–ª–µ–≤–æ ‚Äî –∫ –¢—ë–º–Ω–æ–º—É –æ–º—É—Ç—É", "–¢–∞–º –∂–∏–≤—ë—Ç –í–æ–¥—è–Ω–æ–π, —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –∑–æ–ª–æ—Ç–æ–≥–æ –∫–ª—é—á–∞"),
            ("izbushka", "üèöÔ∏è –ü—Ä—è–º–æ ‚Äî –∫ –ò–∑–±—É—à–∫–µ –Ω–∞ –∫—É—Ä—å–∏—Ö –Ω–æ–∂–∫–∞—Ö", "–¢–∞–º –æ–±–∏—Ç–∞–µ—Ç –ë–∞–±–∞-–Ø–≥–∞, –∑–Ω–∞—é—â–∞—è –º–Ω–æ–≥–æ–µ"),
            ("chasha", "üå≤ –ù–∞–ø—Ä–∞–≤–æ ‚Äî –≤ –¢—ë–º–Ω—É—é —á–∞—â—É", "–í–ª–∞–¥–µ–Ω–∏—è –õ–µ—à–µ–≥–æ, —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –∫–æ—Å—Ç—è–Ω–æ–≥–æ –∫–ª—é—á–∞"),
        ]
        
        if isinstance(hero, Sluga):
            paths.append(("temnaya_tropa", "üï≥Ô∏è –í —Ç–µ–Ω–∏ ‚Äî –¢–∞–π–Ω–∞—è —Ç—Ä–æ–ø–∞", "–ü—É—Ç—å —Å–ª—É–≥ –ö–æ—â–µ—è, –æ–ø–∞—Å–Ω—ã–π, –Ω–æ –∫–æ—Ä–æ—Ç–∫–∏–π"))
        
        result.next_location = show_navigation("opushka", paths)
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å
        path_map = {"omut": "–≤–æ–¥–∞", "izbushka": "–¥—ã–º", "chasha": "—Ç—å–º–∞", "temnaya_tropa": "—Ç–∞–π–Ω—ã–π"}
        if not hero.path_taken:
            hero.path_taken = path_map.get(result.next_location, "")
        
        game_manager.sync_from_hero(hero)
        return result


class Omut(Location):
    """–¢—ë–º–Ω—ã–π –æ–º—É—Ç - –≤–ª–∞–¥–µ–Ω–∏—è –í–æ–¥—è–Ω–æ–≥–æ."""
    
    def __init__(self):
        super().__init__(
            "omut",
            "üíß –¢–Å–ú–ù–´–ô –û–ú–£–¢",
            """
    –¢—Ä–æ–ø–∞ –≤—ã–≤–æ–¥–∏—Ç –∫ –±–µ—Ä–µ–≥—É —Ç—ë–º–Ω–æ–≥–æ –æ–º—É—Ç–∞. –í–æ–¥–∞ —á—ë—Ä–Ω–∞—è,
    –∫–∞–∫ –¥—ë–≥–æ—Ç—å, –∏ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–∞—è ‚Äî –Ω–∏ —Ä—è–±–∏,
    –Ω–∏ –æ—Ç—Ä–∞–∂–µ–Ω–∏–π.
    
    –ù–∞ –±–µ—Ä–µ–≥—É ‚Äî —Å—Ç–∞—Ä–∞—è –ª–æ–¥–∫–∞, –ø–æ–ª—É—Å–≥–Ω–∏–≤—à–∞—è. 
    –ò–∑ –∫–∞–º—ã—à–µ–π —Ç–æ—Ä—á–∏—Ç —Ä–∂–∞–≤–∞—è —Ü–µ–ø—å, —É—Ö–æ–¥—è—â–∞—è –≤ –≤–æ–¥—É.
    
    –í–Ω–µ–∑–∞–ø–Ω–æ –≤–æ–¥–∞ –≤—Å–ø—É—á–∏–≤–∞–µ—Ç—Å—è! –ò–∑ –≥–ª—É–±–∏–Ω—ã –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è
    –æ–≥—Ä–æ–º–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ ‚Äî –±–æ—Ä–æ–¥–∞ –∏–∑ —Ç–∏–Ω—ã, –≥–ª–∞–∑–∞ –∫–∞–∫ –æ–º—É—Ç—ã.
    
    ¬´–ö—Ç–æ –ø–æ—Ç—Ä–µ–≤–æ–∂–∏–ª –º–æ–π –ø–æ–∫–æ–π?¬ª ‚Äî –≥—Ä–µ–º–∏—Ç –≥–æ–ª–æ—Å.
""",
            """
    –¢—ë–º–Ω—ã–π –æ–º—É—Ç —Ç–∏—Ö –∏ —Å–ø–æ–∫–æ–µ–Ω. –í–æ–¥–∞ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —á–µ—Ä–Ω–∞.
    –ù–∞ –±–µ—Ä–µ–≥—É ‚Äî –≤—Å—ë —Ç–µ –∂–µ –∫–∞–º—ã—à–∏ –∏ —Å—Ç–∞—Ä–∞—è –ª–æ–¥–∫–∞.
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        result = super().enter(hero)
        
        # –í–æ–¥—è–Ω–æ–π —É–∂–µ –ø–æ–≤–µ—Ä–∂–µ–Ω/–¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å
        if hero.is_boss_defeated("–≤–æ–¥—è–Ω–æ–π"):
            relation = hero.get_npc_relation("–≤–æ–¥—è–Ω–æ–π")
            
            if relation == "–º–∏—Ä–Ω–æ":
                print("\n  –ò–∑ –≤–æ–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–Ω–∞–∫–æ–º–∞—è —Ñ–∏–≥—É—Ä–∞.")
                print("  ¬´–ê, —ç—Ç–æ —Ç—ã... –ü—Ä–æ—Ö–æ–¥–∏, –∫–æ–ª–∏ –Ω–∞–¥–æ.¬ª")
                print("  –í–æ–¥—è–Ω–æ–π –º–∞—à–µ—Ç —Ä—É–∫–æ–π –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –≥–ª—É–±–∏–Ω–µ.")
            elif relation == "–≤—Ä–∞–∂–¥–µ–±–Ω–æ":
                print("\n  –û–º—É—Ç –ø—É—Å—Ç. –¢–æ–ª—å–∫–æ –∫—Ä—É–≥–∏ –Ω–∞ –≤–æ–¥–µ")
                print("  –Ω–∞–ø–æ–º–∏–Ω–∞—é—Ç –æ –ø—Ä–æ—à–µ–¥—à–µ–π –±–∏—Ç–≤–µ.")
            else:
                print("\n  –í–æ–¥—è–Ω–æ–π –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.")
                print("  –í—ã —Ä–∞–∑–æ—à–ª–∏—Å—å –º–∏—Ä–Ω–æ ‚Äî –æ–Ω –ø–æ–º–Ω–∏—Ç.")
            
            return self._show_navigation(hero, result)
        
        # –ü–µ—Ä–≤–∞—è –≤—Å—Ç—Ä–µ—á–∞ —Å –í–æ–¥—è–Ω—ã–º
        vodyanoy = Vodyanoy()
        
        print("\n  üåä –í–û–î–Ø–ù–û–ô –ø—Ä–µ–≥—Ä–∞–∂–¥–∞–µ—Ç –ø—É—Ç—å!")
        print(f"  (HP: {vodyanoy.hp}, –°–∏–ª–∞: {vodyanoy.strength})")
        
        # –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–ª–∞—Å—Å–∞
        options = ["\n  1. ‚öîÔ∏è ¬´–ü—Ä–æ—á—å —Å –¥–æ—Ä–æ–≥–∏, –Ω–µ—á–∏—Å—Ç—å!¬ª (–±–æ–π)"]
        
        if isinstance(hero, Ivan):
            options.append("  2. üó£Ô∏è ¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –¥–µ–¥—É—à–∫–∞ –í–æ–¥—è–Ω–æ–π!¬ª (—Ä–∞–∑–≥–æ–≤–æ—Ä)")
            if hero.find_item("–ö—Ä–∞—é—Ö–∞ —Ö–ª–µ–±–∞"):
                options.append("  3. üçû –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫—Ä–∞—é—Ö—É —Ö–ª–µ–±–∞")
                max_choice = 3
            else:
                max_choice = 2
        elif isinstance(hero, Vasilisa):
            options.append("  2. üó£Ô∏è –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –º–∞–≥–∏–µ–π")
            options.append("  3. ‚ú® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–µ—Ä–∫–∞–ª—å—Ü–µ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –µ–≥–æ —Å–ª–∞–±–æ—Å—Ç—å")
            max_choice = 3
        else:  # –°–ª—É–≥–∞
            options.append("  2. üíç –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å—Ç–µ–Ω—å –ö–æ—â–µ—è")
            max_choice = 2
        
        choice = show_choice("", options, max_choice)
        
        if choice == 1:
            # –ë–æ–π
            victory, battle_result = boss_battle(hero, vodyanoy, "  –í–æ–¥—è–Ω–æ–π –≤–∑—Ä–µ–≤–µ–ª!")
            
            if not victory:
                if battle_result == "–ø–æ–±–µ–≥":
                    print("\n  –¢—ã —Å–±–µ–≥–∞–µ—à—å –æ—Ç –í–æ–¥—è–Ω–æ–≥–æ...")
                    result.next_location = "opushka"
                    return result
                return LocationResult(game_over=True, victory=False)
            
            print("\n  üèÜ –í–æ–¥—è–Ω–æ–π –ø–æ–≤–µ—Ä–∂–µ–Ω!")
            hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
            
            # –ù–∞–≥—Ä–∞–¥—ã
            print(hero.add_artifact("zolotoy_kluch"))
            if random.random() < 0.5:
                print(hero.add_artifact("klubok"))
        
        elif choice == 2:
            if isinstance(hero, Ivan):
                print("\n  ¬´–í–µ–∂–ª–∏–≤—ã–π...¬ª ‚Äî —É–¥–∏–≤–ª—è–µ—Ç—Å—è –í–æ–¥—è–Ω–æ–π.")
                print("  ¬´–î–∞–≤–Ω–æ –∫–æ –º–Ω–µ —Å –¥–æ–±—Ä–æ–º –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–∏.¬ª")
                print("\n  ¬´–û—Ç–≥–∞–¥–∞–π –∑–∞–≥–∞–¥–∫—É ‚Äî –ø—Ä–æ–ø—É—â—É.¬ª")
                print("  ¬´–ë–µ–∑ —Ä—É–∫, –±–µ–∑ –Ω–æ–≥, –∞ –±–µ–∂–∏—Ç. –ß—Ç–æ —ç—Ç–æ?¬ª")
                
                print("\n  1. –í–æ–¥–∞")
                print("  2. –í–µ—Ç–µ—Ä")
                print("  3. –í—Ä–µ–º—è")
                
                ans = get_input_with_menu("\n  –û—Ç–≤–µ—Ç: ", range(1, 4), 
                    "¬´–ë–µ–∑ —Ä—É–∫, –±–µ–∑ –Ω–æ–≥, –∞ –±–µ–∂–∏—Ç. –ß—Ç–æ —ç—Ç–æ?¬ª",
                    ["  1. –í–æ–¥–∞", "  2. –í–µ—Ç–µ—Ä", "  3. –í—Ä–µ–º—è"])
                
                if ans == 1:
                    print("\n  ¬´–í–µ—Ä–Ω–æ! –í–æ–¥–∞ —è –∏ –µ—Å—Ç—å...¬ª")
                    print("  –í–æ–¥—è–Ω–æ–π –∫–∏–≤–∞–µ—Ç —Å —É–≤–∞–∂–µ–Ω–∏–µ–º.")
                    print(hero.add_artifact("zolotoy_kluch"))
                    hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–º–∏—Ä–Ω–æ")
                    hero.defeat_boss("–≤–æ–¥—è–Ω–æ–π")
                else:
                    print("\n  ¬´–ù–µ–≤–µ—Ä–Ω–æ! –ê —è –¥—É–º–∞–ª, —Ç—ã —É–º–Ω–µ–µ...¬ª")
                    victory, _ = boss_battle(hero, vodyanoy)
                    if not victory:
                        return LocationResult(game_over=True, victory=False)
                    print(hero.add_artifact("zolotoy_kluch"))
                    hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
            
            elif isinstance(hero, Vasilisa):
                print("\n  –¢—ã –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—à—å —Å–ª–æ–≤–∞ –¥—Ä–µ–≤–Ω–µ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è...")
                print("  ¬´–ö–æ–ª–¥—É–Ω—å—è?¬ª ‚Äî –í–æ–¥—è–Ω–æ–π –Ω–∞—Å—Ç–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è.")
                print("  ¬´–ó–Ω–∞—é —è –≤–∞—à—É –ø–æ—Ä–æ–¥—É. –ö–æ—â–µ–µ–≤—ã —à—Ç—É—á–∫–∏!¬ª")
                
                print("\n  ¬´–ù–æ... –µ—Å–ª–∏ —Ç—ã –¥–æ—á—å —Ç–æ–≥–æ –∫–æ–ª–¥—É–Ω–∞...¬ª")
                print("  ¬´–Ø –ø–æ–º–Ω—é –µ–≥–æ. –û–Ω –±—ã–ª... —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤.¬ª")
                print("  ¬´–ë–µ—Ä–∏ –∫–ª—é—á –∏ —É—Ö–æ–¥–∏. –ù–æ –µ—Å–ª–∏ –æ–±–º–∞–Ω–µ—à—å...¬ª")
                
                print(hero.add_artifact("zolotoy_kluch"))
                hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                hero.defeat_boss("–≤–æ–¥—è–Ω–æ–π")
            
            else:  # –°–ª—É–≥–∞
                print("\n  –¢—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—à—å –ø–µ—Ä—Å—Ç–µ–Ω—å.")
                print("  –í–æ–¥—è–Ω–æ–π –æ—Ç—à–∞—Ç—ã–≤–∞–µ—Ç—Å—è!")
                print("\n  ¬´–ö-–∫–æ—â–µ–µ–≤ —Å–ª—É–≥–∞?! –ß–µ–≥–æ —Ç–µ–±–µ –Ω–∞–¥–æ?¬ª")
                print("  ¬´–ö–ª—é—á? –ó–∞–±–∏—Ä–∞–π... —Ç–æ–ª—å–∫–æ —É–±–∏—Ä–∞–π—Å—è!¬ª")
                
                print(hero.add_artifact("zolotoy_kluch"))
                hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
                hero.defeat_boss("–≤–æ–¥—è–Ω–æ–π")
        
        elif choice == 3:
            if isinstance(hero, Ivan):
                # –•–ª–µ–±
                print("\n  –¢—ã –¥–æ—Å—Ç–∞—ë—à—å –∫—Ä–∞—é—Ö—É —Ö–ª–µ–±–∞.")
                print("  ¬´–ú–∞—Ç—É—à–∫–∞ –¥–∞–ª–∞. –í–æ–∑—å–º–∏, –¥–µ–¥—É—à–∫–∞.¬ª")
                print("\n  –í–æ–¥—è–Ω–æ–π –∑–∞–º–∏—Ä–∞–µ—Ç. –¢—è–Ω–µ—Ç—Å—è –∫ —Ö–ª–µ–±—É.")
                print("  ¬´–•–ª–µ–±... –°–∫–æ–ª—å–∫–æ –≤–µ–∫–æ–≤ –Ω–µ –≤–∏–¥–µ–ª...¬ª")
                print("\n  –û–Ω –±–µ—Ä—ë—Ç –∫—Ä–∞—é—Ö—É –±–µ—Ä–µ–∂–Ω–æ, –∫–∞–∫ —Å–æ–∫—Ä–æ–≤–∏—â–µ.")
                print("  ¬´–î–æ–±—Ä—ã–π —Ç—ã, —á–µ–ª–æ–≤–µ–∫. –†–µ–¥–∫–æ—Å—Ç—å –Ω—ã–Ω—á–µ.¬ª")
                
                bread = hero.find_item("–ö—Ä–∞—é—Ö–∞ —Ö–ª–µ–±–∞")
                if bread:
                    hero.remove_item(bread)
                
                print(hero.add_artifact("zolotoy_kluch"))
                print(hero.add_artifact("klubok"))
                print(hero.add_artifact("voda_zhizni"))
                hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–º–∏—Ä–Ω–æ")
                hero.defeat_boss("–≤–æ–¥—è–Ω–æ–π")
            
            else:  # –í–∞—Å–∏–ª–∏—Å–∞ - –∑–µ—Ä–∫–∞–ª—å—Ü–µ
                print("\n  –¢—ã –¥–æ—Å—Ç–∞—ë—à—å –∑–µ—Ä–∫–∞–ª—å—Ü–µ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—à—å –Ω–∞ –í–æ–¥—è–Ω–æ–≥–æ.")
                print("  –í –æ—Ç—Ä–∞–∂–µ–Ω–∏–∏ –≤–∏–¥–Ω–æ: –æ–Ω –±–æ–∏—Ç—Å—è –æ–≥–Ω—è!")
                print("\n  ¬´–£–±–µ—Ä–∏! –£–±–µ—Ä–∏ —ç—Ç—É –¥—Ä—è–Ω—å!¬ª ‚Äî —à–∏–ø–∏—Ç –í–æ–¥—è–Ω–æ–π.")
                print("  ¬´–õ–∞–¥–Ω–æ, –ª–∞–¥–Ω–æ... –ë–µ—Ä–∏ –∫–ª—é—á, —Ç–æ–ª—å–∫–æ —É—Ö–æ–¥–∏!¬ª")
                
                print(hero.add_artifact("zolotoy_kluch"))
                hero.set_npc_relation("–≤–æ–¥—è–Ω–æ–π", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                hero.defeat_boss("–≤–æ–¥—è–Ω–æ–π")
        
        return self._show_navigation(hero, result)
    
    def _show_navigation(self, hero: Hero, result: LocationResult) -> LocationResult:
        """–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏–π."""
        print("\n" + "‚îÄ" * 50)
        
        paths = [
            ("opushka", "üå≤ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–∑–≤–∏–ª–∫–µ", "–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å"),
            ("serdce", "üíé –ö –°–µ—Ä–¥—Ü—É –ª–µ—Å–∞", f"–¢–∞–º —Å—É–Ω–¥—É–∫ —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ (–∫–ª—é—á–µ–π: {hero.count_keys()}/3)"),
        ]
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏
        if hero.has_artifact("klubok"):
            paths.append(("izbushka", "üß∂ –°–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –∫–ª—É–±–∫–æ–º", "–ö–ª—É–±–æ–∫ –≤–µ–¥—ë—Ç –∫ –∏–∑–±—É—à–∫–µ"))
        
        result.next_location = show_navigation("omut", paths)
        game_manager.sync_from_hero(hero)
        return result


class Izbushka(Location):
    """–ò–∑–±—É—à–∫–∞ –Ω–∞ –∫—É—Ä—å–∏—Ö –Ω–æ–∂–∫–∞—Ö."""
    
    def __init__(self):
        super().__init__(
            "izbushka",
            "üèöÔ∏è –ò–ó–ë–£–®–ö–ê –ù–ê –ö–£–†–¨–ò–• –ù–û–ñ–ö–ê–•",
            """
    –¢—Ä–æ–ø–∞ –≤—ã–≤–æ–¥–∏—Ç –Ω–∞ –ø–æ–ª—è–Ω—É. –ü–æ—Å—Ä–µ–¥–∏ –Ω–µ—ë ‚Äî –∏–∑–±—É—à–∫–∞!
    –°—Ç–æ–∏—Ç –Ω–∞ –æ–≥—Ä–æ–º–Ω—ã—Ö –∫—É—Ä—å–∏—Ö –Ω–æ–≥–∞—Ö, –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è,
    —Å–∫—Ä–∏–ø–∏—Ç —Å—Ç–∞–≤–Ω—è–º–∏, –±—É–¥—Ç–æ –≤—ã—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∫–æ–≥–æ-—Ç–æ.
    
    ¬´–ò–∑–±—É—à–∫–∞-–∏–∑–±—É—à–∫–∞, —Å—Ç–∞–Ω—å –∫ –ª–µ—Å—É –∑–∞–¥–æ–º, 
    –∫–æ –º–Ω–µ –ø–µ—Ä–µ–¥–æ–º!¬ª ‚Äî –≤—Å–ø–æ–º–∏–Ω–∞–µ—à—å —Ç—ã —Å–ª–æ–≤–∞.
    
    –ò–∑–±—É—à–∫–∞ —Å–æ —Å–∫—Ä–∏–ø–æ–º –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è. –î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
    –ù–∞ –ø–æ—Ä–æ–≥–µ ‚Äî –ë–∞–±–∞-–Ø–≥–∞! –ö–æ—Å—Ç—è–Ω–∞—è –Ω–æ–≥–∞, –∫—Ä—é—á–∫–æ–≤–∞—Ç—ã–π –Ω–æ—Å,
    –≥–ª–∞–∑–∞ –≥–æ—Ä—è—Ç –Ω–µ–¥–æ–±—Ä—ã–º –æ–≥–Ω—ë–º.
    
    ¬´–§—É-—Ñ—É! –†—É—Å—Å–∫–∏–º –¥—É—Ö–æ–º –ø–∞—Ö–Ω–µ—Ç!
    –ö—Ç–æ —Ç–∞–∫–æ–π? –ó–∞—á–µ–º –ø–æ–∂–∞–ª–æ–≤–∞–ª?¬ª
""",
            """
    –ò–∑–±—É—à–∫–∞ —Å—Ç–æ–∏—Ç —Å–º–∏—Ä–Ω–æ, –∫—É—Ä—å–∏ –Ω–æ–≥–∏ –ø–æ–¥–∂–∞—Ç—ã.
    –î—ã–º –∏–¥—ë—Ç –∏–∑ —Ç—Ä—É–±—ã ‚Äî —Ö–æ–∑—è–π–∫–∞ –¥–æ–º–∞.
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        result = super().enter(hero)
        
        # –Ø–≥–∞ —É–∂–µ –≤—Å—Ç—Ä–µ—á–µ–Ω–∞
        if hero.is_boss_defeated("—è–≥–∞"):
            relation = hero.get_npc_relation("—è–≥–∞")
            
            if relation == "–º–∏—Ä–Ω–æ":
                print("\n  –î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.")
                print("  ¬´–ê, —ç—Ç–æ —Ç—ã! –ó–∞—Ö–æ–¥–∏, —á–∞—é –Ω–∞–ª—å—é.¬ª")
                print("  –Ø–≥–∞ –º–∞—à–µ—Ç –º–µ—Ç–ª–æ–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.")
                
                # –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–º–æ—â—å/—Å–æ–≤–µ—Ç
                print("\n  ¬´–ß–µ–≥–æ –Ω–∞–¥–æ-—Ç–æ?¬ª")
                print("\n  1. ¬´–°–ø–∞—Å–∏–±–æ, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏–ª –º–∏–º–æ¬ª")
                print("  2. ¬´–ï—Å—Ç—å –ª–∏ –∑–µ–ª—å—è –∫–∞–∫–∏–µ?¬ª")
                
                choice = get_input_with_menu("\n  –í—ã–±–æ—Ä: ", range(1, 3))
                
                if choice == 2:
                    if not hero.get_flag("yaga_potion_given"):
                        hero.set_flag("yaga_potion_given", True)
                        hero.add_item(Item("üß™ –Ø–≥–æ–≤–æ–µ –∑–µ–ª—å–µ", "–ó–µ–ª—å–µ –ë–∞–±—ã-–Ø–≥–∏, –ª–µ—á–∏—Ç 60 HP", "heal", hp_restore=60))
                        
                        # –†–∞–∑–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
                        if isinstance(hero, Ivan):
                            print("\n  ¬´–ù–∞, –¥–µ—Ä–∂–∏. –ó–∞—Ä–∞–±–æ—Ç–∞–ª —á–µ—Å—Ç–Ω–æ.¬ª")
                        elif isinstance(hero, Vasilisa):
                            print("\n  ¬´–ù–∞, –≤–Ω—É—á–µ–Ω—å–∫–∞. –ë–µ—Ä–µ–≥–∏ —Å–µ–±—è.¬ª")
                        else:
                            print("\n  ¬´–ù–∞, –¥–µ—Ä–∂–∏. –¢–æ–ª—å–∫–æ –Ω–µ –≥–æ–≤–æ—Ä–∏ –Ω–∏–∫–æ–º—É.¬ª")
                    else:
                        print("\n  ¬´–£–∂–µ –¥–∞–≤–∞–ª–∞! –ù–µ –∂–∞–¥–Ω–∏—á–∞–π!¬ª")
            
            elif relation == "–≤—Ä–∞–∂–¥–µ–±–Ω–æ":
                print("\n  –ò–∑–±—É—à–∫–∞ –æ—Ç–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–±—è!")
                print("  –Ø–≥–∞ –Ω–µ —Ö–æ—á–µ—Ç —Ç–µ–±—è –≤–∏–¥–µ—Ç—å –ø–æ—Å–ª–µ –¥—Ä–∞–∫–∏.")
            else:
                print("\n  –Ø–≥–∞ –≤—ã–≥–ª—è–¥—ã–≤–∞–µ—Ç –≤ –æ–∫–Ω–æ, –Ω–æ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç.")
            
            return self._show_navigation(hero, result)
        
        # –ü–µ—Ä–≤–∞—è –≤—Å—Ç—Ä–µ—á–∞
        yaga = BabaYaga()
        
        if isinstance(hero, Vasilisa):
            print("\n  –Ø–≥–∞ –ø—Ä–∏—â—É—Ä–∏–≤–∞–µ—Ç—Å—è...")
            print("  ¬´–ü–æ–≥–æ–¥–∏-–∫–∞... –≠—Ç–æ –∂ –¥–æ—á–∫–∞ –∫–æ–ª–¥—É–Ω–∞!¬ª")
            print("  ¬´–ó–Ω–∞–ª–∞ —è —Ç–≤–æ–µ–≥–æ –æ—Ç—Ü–∞. –•–æ—Ä–æ—à–∏–π –±—ã–ª —á–µ–ª–æ–≤–µ–∫.¬ª")
            print("  ¬´–ó–∞—Ö–æ–¥–∏, –≤–Ω—É—á–µ–Ω—å–∫–∞. –ß–∞—é –ø–æ–ø—å—ë–º.¬ª")
            
            hero.set_npc_relation("—è–≥–∞", "–º–∏—Ä–Ω–æ")
            hero.defeat_boss("—è–≥–∞")
            
            print("\n  –ó–∞ —Å—Ç–æ–ª–æ–º –Ø–≥–∞ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç:")
            print("  ¬´–ö–æ—â–µ–π –ø—Ä–æ–∫–ª—è–ª —Ç–≤–æ–µ–≥–æ –æ—Ç—Ü–∞ –∏–∑ –∑–∞–≤–∏—Å—Ç–∏.¬ª")
            print("  ¬´–°–≤–∏—Ç–æ–∫ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è ‚Äî –≤ —Å—É–Ω–¥—É–∫–µ –≤ –°–µ—Ä–¥—Ü–µ –ª–µ—Å–∞.¬ª")
            print("  ¬´–í–æ—Ç —Ç–µ–±–µ –∫–ª—é—á–∏–∫. –ò –∑–µ–ª—å–µ –Ω–∞ –¥–æ—Ä–æ–∂–∫—É.¬ª")
            
            print(hero.add_artifact("serebryany_kluch"))
            hero.add_item(Item("üíß –ó–µ–ª—å–µ –º–∞–Ω—ã", "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 40 MP", "mana", mp_restore=40))
            print("  üéÅ –ü–æ–ª—É—á–µ–Ω–æ: üíß –ó–µ–ª—å–µ –º–∞–Ω—ã (+40 MP)")
        
        elif isinstance(hero, Ivan):
            print("\n  ¬´–≠–∫–∞ –Ω–µ–≤–∏–¥–∞–ª—å ‚Äî –¥—É—Ä–∞—á–æ–∫ –¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏–π!¬ª")
            print("  ¬´–ù—É, —Ä–∞–∑ –ø—Ä–∏—à—ë–ª ‚Äî —Ä–∞–±–æ—Ç–∞—Ç—å –±—É–¥–µ—à—å!¬ª")
            print("\n  ¬´–ë–∞–Ω—é –∏—Å—Ç–æ–ø–∏, –∏–∑–±—É –ø–æ–¥–º–µ—Ç–∏,")
            print("  –∞ —Ç–∞–º –ø–æ—Å–º–æ—Ç—Ä–∏–º, —Å—ä–µ—Å—Ç—å —Ç–µ–±—è –∏–ª–∏ –Ω–µ—Ç.¬ª")
            
            print("\n  1. üí™ –í–∑—è—Ç—å—Å—è –∑–∞ —Ä–∞–±–æ—Ç—É")
            print("  2. üçÄ ¬´–ê–≤–æ—Å—å —Å–∞–º–æ —Å–¥–µ–ª–∞–µ—Ç—Å—è!¬ª")
            print("  3. ‚öîÔ∏è ¬´–ù–µ –±—É–¥—É! –î–µ—Ä–∏—Å—å!¬ª")
            
            choice = get_input_with_menu("\n  –í—ã–±–æ—Ä: ", range(1, 4))
            
            if choice == 1:
                print("\n  –¢—ã –±–µ—Ä—ë—à—å—Å—è –∑–∞ –≤–µ–Ω–∏–∫, –ø–æ—Ç–æ–º –∑–∞ –¥—Ä–æ–≤–∞...")
                print("  –†–∞–±–æ—Ç–∞–µ—à—å —á–µ—Å—Ç–Ω–æ, —Ö–æ—Ç—å –∏ —Ç—Ä—É–¥–Ω–æ.")
                print("  –Ø–≥–∞ –Ω–∞–±–ª—é–¥–∞–µ—Ç, –∫–∏–≤–∞–µ—Ç.")
                print("\n  ¬´–ú–æ–ª–æ–¥–µ—Ü! –ù–µ –ª–µ–Ω–∏–≤—ã–π, –Ω–µ –∑–ª–æ–π.¬ª")
                print("  ¬´–î–µ—Ä–∂–∏ –∫–ª—é—á–∏–∫, –∑–∞—Å–ª—É–∂–∏–ª.¬ª")
                
                print(hero.add_artifact("serebryany_kluch"))
                hero.set_npc_relation("—è–≥–∞", "–º–∏—Ä–Ω–æ")
                hero.defeat_boss("—è–≥–∞")
            
            elif choice == 2:
                if random.random() < 0.6:
                    print("\n  –¢—ã —Å–∞–¥–∏—à—å—Å—è –Ω–∞ –ª–∞–≤–∫—É –∏ –∂–¥—ë—à—å.")
                    print("  –í–¥—Ä—É–≥ –≤–µ–Ω–∏–∫ —Å–∞–º –Ω–∞—á–∏–Ω–∞–µ—Ç –º–µ—Å—Ç–∏!")
                    print("  –î—Ä–æ–≤–∞ —Å–∞–º–∏ –ø—Ä—ã–≥–∞—é—Ç –≤ –ø–µ—á—å!")
                    print("\n  –Ø–≥–∞ –≤—ã–ø—É—á–∏–≤–∞–µ—Ç –≥–ª–∞–∑–∞.")
                    print("  ¬´–í–æ—Ç —Ç–µ –Ω–∞! –¢—ã, –Ω–∏–∫–∞–∫, –≤–µ–∑—É—á–∏–π?¬ª")
                    print("  ¬´–¢–∞–∫–æ–≥–æ —è –µ—â—ë –Ω–µ –≤–∏–¥–∞–ª–∞!¬ª")
                    print("  ¬´–ù–∞, –¥–µ—Ä–∂–∏ –∫–ª—é—á! –ò —É–±–∏—Ä–∞–π—Å—è!¬ª")
                    
                    print(hero.add_artifact("serebryany_kluch"))
                    hero.set_npc_relation("—è–≥–∞", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                    hero.defeat_boss("—è–≥–∞")
                else:
                    print("\n  –ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.")
                    print("  ¬´–û–±–ª–µ–Ω–∏–ª—Å—è! –°–µ–π—á–∞—Å —Å—ä–µ–º!¬ª")
                    victory, _ = boss_battle(hero, yaga)
                    if not victory:
                        return LocationResult(game_over=True, victory=False)
                    print(hero.add_artifact("serebryany_kluch"))
                    hero.set_npc_relation("—è–≥–∞", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
            
            else:  # –ë–æ–π
                print("\n  ¬´–ê—Ö —Ç—ã –Ω–∞–≥–ª–µ—Ü!¬ª")
                victory, _ = boss_battle(hero, yaga, "  –Ø–≥–∞ —Ö–≤–∞—Ç–∞–µ—Ç –º–µ—Ç–ª—É!")
                if not victory:
                    return LocationResult(game_over=True, victory=False)
                print(hero.add_artifact("serebryany_kluch"))
                hero.set_npc_relation("—è–≥–∞", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
        
        else:  # –°–ª—É–≥–∞
            print("\n  –Ø–≥–∞ –ø—Ä–∏–Ω—é—Ö–∏–≤–∞–µ—Ç—Å—è...")
            print("  ¬´–¢—å—Ñ—É! –ö–æ—â–µ–µ–º –æ—Ç —Ç–µ–±—è —Ä–∞–∑–∏—Ç!¬ª")
            print("  ¬´–ü—Ä–µ–¥–∞—Ç–µ–ª—å! –°–ª—É–≥–∞ –ø–µ—Ä–µ–º–µ—Ç–Ω—É–ª—Å—è!¬ª")
            print("\n  ¬´–ù–µ –±—É–¥–µ—Ç —Ç–µ–±–µ –º–æ–µ–π –ø–æ–º–æ—â–∏!¬ª")
            
            print("\n  1. ‚öîÔ∏è ¬´–¢–æ–≥–¥–∞ —Å–∏–ª–æ–π –≤–æ–∑—å–º—É!¬ª")
            print("  2. üó£Ô∏è ¬´–Ø –±–æ–ª—å—à–µ –Ω–µ —Å–ª—É–∂—É –µ–º—É¬ª")
            print("  3. üíç –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å—Ç–µ–Ω—å")
            
            choice = get_input_with_menu("\n  –í—ã–±–æ—Ä: ", range(1, 4))
            
            if choice == 1:
                victory, _ = boss_battle(hero, yaga, "  –Ø–≥–∞ —à–∏–ø–∏—Ç –æ—Ç –∑–ª–æ—Å—Ç–∏!")
                if not victory:
                    return LocationResult(game_over=True, victory=False)
                print(hero.add_artifact("serebryany_kluch"))
                hero.set_npc_relation("—è–≥–∞", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
            
            elif choice == 2:
                print("\n  ¬´–ù–µ —Å–ª—É–∂–∏—à—å? –î–æ–∫–∞–∂–∏!¬ª")
                print("  ¬´–°–Ω–∏–º–∏ –ø–µ—Ä—Å—Ç–µ–Ω—å –∏ –±—Ä–æ—Å—å –≤ –æ–≥–æ–Ω—å!¬ª")
                
                print("\n  1. –ë—Ä–æ—Å–∏—Ç—å –ø–µ—Ä—Å—Ç–µ–Ω—å")
                print("  2. ¬´–ù–µ—Ç, –æ–Ω –º–Ω–µ –Ω—É–∂–µ–Ω¬ª")
                
                c2 = get_input_with_menu("\n  –í—ã–±–æ—Ä: ", range(1, 3))
                
                if c2 == 1:
                    print("\n  –¢—ã —Å—Ä—ã–≤–∞–µ—à—å –ø–µ—Ä—Å—Ç–µ–Ω—å...")
                    print("  –û–Ω –∂–∂—ë—Ç –ø–∞–ª—å—Ü—ã! –ù–æ —Ç—ã –±—Ä–æ—Å–∞–µ—à—å –µ–≥–æ –≤ –ø–µ—á—å.")
                    print("  –ü–µ—Ä—Å—Ç–µ–Ω—å –ø–ª–∞–≤–∏—Ç—Å—è —Å –≤–æ–µ–º.")
                    print("\n  –Ø–≥–∞ –∫–∏–≤–∞–µ—Ç.")
                    print("  ¬´–í–µ—Ä—é —Ç–µ–ø–µ—Ä—å. –°–≤–æ–±–æ–¥–µ–Ω —Ç—ã.¬ª")
                    print("  ¬´–í–æ—Ç –∫–ª—é—á. –ò –∑–∞–ø–æ–º–Ω–∏ ‚Äî –ö–æ—â–µ–π —Ç–µ–±—è –Ω–µ –ø—Ä–æ—Å—Ç–∏—Ç.¬ª")
                    
                    # –¢–µ—Ä—è–µ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –ø–µ—Ä—Å—Ç–Ω—è
                    hero.artifacts = [a for a in hero.artifacts if a.id != "persten"]
                    print(hero.add_artifact("serebryany_kluch"))
                    hero.set_npc_relation("—è–≥–∞", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                    hero.defeat_boss("—è–≥–∞")
                else:
                    print("\n  ¬´–¢–æ–≥–¥–∞ –ø—Ä–æ—á—å –∏–∑ –º–æ–µ–≥–æ –¥–æ–º–∞!¬ª")
                    print("  –Ø–≥–∞ –≤—ã–≥–æ–Ω—è–µ—Ç —Ç–µ–±—è –º–µ—Ç–ª–æ–π.")
                    result.next_location = "opushka"
                    return result
            
            else:  # –ü–µ—Ä—Å—Ç–µ–Ω—å
                print("\n  –¢—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—à—å –ø–µ—Ä—Å—Ç–µ–Ω—å.")
                print("  –Ø–≥–∞ —à–∏–ø–∏—Ç –∏ –æ—Ç—à–∞—Ç—ã–≤–∞–µ—Ç—Å—è!")
                print("  ¬´–£–±–µ—Ä–∏ —ç—Ç—É –≥–∞–¥–æ—Å—Ç—å!¬ª")
                print("\n  ¬´–õ–∞–¥–Ω–æ, –ª–∞–¥–Ω–æ... –ë–µ—Ä–∏ –∫–ª—é—á –∏ —É—Ö–æ–¥–∏!¬ª")
                print("  ¬´–¢–æ–ª—å–∫–æ –ø–æ–º–Ω–∏ ‚Äî —è —Ç–µ–±–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–∞–≤–∞–ª–∞!¬ª")
                
                print(hero.add_artifact("serebryany_kluch"))
                hero.set_npc_relation("—è–≥–∞", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
                hero.defeat_boss("—è–≥–∞")
        
        return self._show_navigation(hero, result)
    
    def _show_navigation(self, hero: Hero, result: LocationResult) -> LocationResult:
        print("\n" + "‚îÄ" * 50)
        
        paths = [
            ("opushka", "üå≤ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–∑–≤–∏–ª–∫–µ", "–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å"),
            ("ovrag", "üéµ –ö –°–æ–ª–æ–≤—å–∏–Ω–æ–º—É –æ–≤—Ä–∞–≥—É", "–¢–∞–º –ª–æ–≥–æ–≤–æ –°–æ–ª–æ–≤—å—è-—Ä–∞–∑–±–æ–π–Ω–∏–∫–∞"),
            ("serdce", "üíé –ö –°–µ—Ä–¥—Ü—É –ª–µ—Å–∞", f"–¢–∞–º —Å—É–Ω–¥—É–∫ (–∫–ª—é—á–µ–π: {hero.count_keys()}/3)"),
        ]
        
        result.next_location = show_navigation("izbushka", paths)
        game_manager.sync_from_hero(hero)
        return result


class Ovrag(Location):
    """–°–æ–ª–æ–≤—å–∏–Ω—ã–π –æ–≤—Ä–∞–≥."""
    
    def __init__(self):
        super().__init__(
            "ovrag",
            "üéµ –°–û–õ–û–í–¨–ò–ù–´–ô –û–í–†–ê–ì",
            """
    –¢—Ä–æ–ø–∞ —Å–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –≥–ª—É–±–æ–∫–∏–π –æ–≤—Ä–∞–≥. 
    –ù–∞ –æ–≥—Ä–æ–º–Ω–æ–º –¥—É–±—É ‚Äî –≥–Ω–µ–∑–¥–æ –∏–∑ –∫–æ—Å—Ç–µ–π!
    
    –ù–∞ –≤–µ—Ç–∫–µ —Å–∏–¥–∏—Ç –≥—Ä–æ–º–∞–¥–Ω—ã–π –¥–µ—Ç–∏–Ω–∞ —Å 
    –ø—Ç–∏—á—å–∏–º –∫–ª—é–≤–æ–º –≤–º–µ—Å—Ç–æ –Ω–æ—Å–∞. –≠—Ç–æ –°–æ–ª–æ–≤–µ–π-—Ä–∞–∑–±–æ–π–Ω–∏–∫!
    
    ¬´–û-—Ö–æ-—Ö–æ! –ü—É—Ç–Ω–∏—á–µ–∫! –ü–ª–∞—Ç–∏ –¥–∞–Ω—å
    –∏–ª–∏ –ø–æ—Å–ª—É—à–∞–π –º–æ–π —Å–≤–∏—Å—Ç!¬ª
    
    –û–Ω –Ω–∞–±–∏—Ä–∞–µ—Ç –≤–æ–∑–¥—É—Ö –≤ –≥—Ä—É–¥—å...
""",
            """
    –û–≤—Ä–∞–≥ —Ç–∏—Ö. –°—Ç–∞—Ä—ã–π –¥—É–± –≤—Å—ë —Ç–∞–∫ –∂–µ —Å—Ç–æ–∏—Ç,
    –Ω–æ –≥–Ω–µ–∑–¥–æ –æ–ø—É—Å—Ç–µ–ª–æ.
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        result = super().enter(hero)
        
        if hero.is_boss_defeated("—Å–æ–ª–æ–≤–µ–π"):
            relation = hero.get_npc_relation("—Å–æ–ª–æ–≤–µ–π")
            
            if relation == "–º–∏—Ä–Ω–æ":
                print("\n  –°–æ–ª–æ–≤–µ–π –º–∞—à–µ—Ç —Å –≤–µ—Ç–∫–∏.")
                print("  ¬´–ó–¥–æ—Ä–æ–≤–æ! –ü—Ä–æ—Ö–æ–¥–∏, –Ω–µ —Ç—Ä–æ–Ω—É.¬ª")
            else:
                print("\n  –°–æ–ª–æ–≤—å—è –Ω–µ—Ç. –û–≤—Ä–∞–≥ –ø—É—Å—Ç.")
            
            return self._show_navigation(hero, result)
        
        solovey = SoloveyRazboynik()
        
        print(f"\n  üéµ –°–û–õ–û–í–ï–ô-–†–ê–ó–ë–û–ô–ù–ò–ö!")
        print(f"  (HP: {solovey.hp}, –°–∏–ª–∞: {solovey.strength})")
        
        # –í–ê–ñ–ù–û: –Ω–µ–ª—å–∑—è –æ—Ç–¥–∞–≤–∞—Ç—å –∫–ª—é—á–∏!
        has_keys = hero.count_keys() > 0
        
        options = ["\n  1. ‚öîÔ∏è ¬´–°–≤–∏—Å—Ç–∏, —Å–≤–∏—Å—Ç–∏ ‚Äî —è –Ω–µ –±–æ—é—Å—å!¬ª (–±–æ–π)"]
        
        if has_keys:
            options.append("  2. üí∞ ¬´–ë–µ—Ä–∏ –¥–∞–Ω—å!¬ª [‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –∫–ª—é—á –æ—Ç–¥–∞—Ç—å –Ω–µ–ª—å–∑—è!]")
        
        if isinstance(hero, Sluga):
            options.append(f"  {len(options) + 1}. üíç –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å—Ç–µ–Ω—å –ö–æ—â–µ—è")
        if isinstance(hero, Vasilisa):
            options.append(f"  {len(options) + 1}. ‚ú® –°—Ç–∞—Ç—å –Ω–µ–≤–∏–¥–∏–º–æ–π")
        if isinstance(hero, Ivan):
            options.append(f"  {len(options) + 1}. üòä ¬´–•–æ—á–µ—à—å, –ø–µ—Å–Ω—é —Å–ø–æ—é?¬ª")
        
        max_c = len(options)
        choice = show_choice("", options, max_c)
        
        if choice == 1:
            victory, _ = boss_battle(hero, solovey, "  –°–æ–ª–æ–≤–µ–π —Å–≤–∏—Å—Ç–∏—Ç –æ–≥–ª—É—à–∏—Ç–µ–ª—å–Ω–æ!")
            if not victory:
                return LocationResult(game_over=True, victory=False)
            
            print(hero.add_artifact("yayco"))
            hero.set_npc_relation("—Å–æ–ª–æ–≤–µ–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
        
        elif choice == 2 and has_keys:
            print("\n  –°–æ–ª–æ–≤–µ–π –ø–æ—Ç–∏—Ä–∞–µ—Ç —Ä—É–∫–∏.")
            print("  ¬´–î–∞–Ω—å? –î–∞–≤–∞–π! –ß—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å?¬ª")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –º–æ–∂–Ω–æ –æ—Ç–¥–∞—Ç—å (–ù–ï –∫–ª—é—á–∏!)
            tribute_items = [i for i in hero.inventory if i.item_type != "key"]
            tribute_artifacts = [a for a in hero.artifacts 
                               if a.id not in ("zolotoy_kluch", "serebryany_kluch", "kostyanoy_kluch")]
            
            if not tribute_items and not tribute_artifacts:
                print("\n  ¬´–•–∞! –£ —Ç–µ–±—è —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏? –ù–µ-–µ-–µ—Ç!¬ª")
                print("  ¬´–ö–ª—é—á–∏ –º–Ω–µ –Ω–µ –Ω—É–∂–Ω—ã! –î–ï–†–ò–°–¨!¬ª")
                victory, _ = boss_battle(hero, solovey)
                if not victory:
                    return LocationResult(game_over=True, victory=False)
                print(hero.add_artifact("yayco"))
                hero.set_npc_relation("—Å–æ–ª–æ–≤–µ–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
            else:
                print("\n  ‚ö†Ô∏è –ù–ï–õ–¨–ó–Ø –û–¢–î–ê–í–ê–¢–¨ –ö–õ–Æ–ß–ò!")
                print("  –°–æ–ª–æ–≤–µ–π –∑–∞–±–∏—Ä–∞–µ—Ç —á—Ç–æ-—Ç–æ –∏–∑ —Ç–≤–æ–∏—Ö –≤–µ—â–µ–π...\n")
                
                if tribute_artifacts:
                    lost = tribute_artifacts[0]
                    hero.artifacts = [a for a in hero.artifacts if a.id != lost.id]
                    print(f"  –°–æ–ª–æ–≤–µ–π –∑–∞–±—Ä–∞–ª: {lost.name}")
                elif tribute_items:
                    lost = tribute_items[0]
                    hero.remove_item(lost)
                    print(f"  –°–æ–ª–æ–≤–µ–π –∑–∞–±—Ä–∞–ª: {lost.name}")
                
                print("\n  ¬´–•–µ-—Ö–µ! –î–∞–≤–∞–π –µ—â—ë!¬ª")
                print("  ¬´–õ–∞–¥–Ω–æ, –ª–∞–¥–Ω–æ, –ø—Ä–æ—Ö–æ–¥–∏...¬ª")
                hero.set_npc_relation("—Å–æ–ª–æ–≤–µ–π", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                hero.defeat_boss("—Å–æ–ª–æ–≤–µ–π")
        
        else:
            # –ö–ª–∞—Å—Å–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã
            if isinstance(hero, Sluga):
                print("\n  –¢—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—à—å –ø–µ—Ä—Å—Ç–µ–Ω—å.")
                print("  –°–æ–ª–æ–≤–µ–π –±–ª–µ–¥–Ω–µ–µ—Ç!")
                print("  ¬´–ö-–∫–æ—â–µ–µ–≤?! –ü-–ø—Ä–æ—Å—Ç–∏, —Ö–æ–∑—è–∏–Ω!¬ª")
                print("  ¬´–í–æ—Ç, –≤–æ–∑—å–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ –Ω–µ –≥–æ–≤–æ—Ä–∏ –µ–º—É!¬ª")
                
                print(hero.add_artifact("dudochka"))
                hero.set_npc_relation("—Å–æ–ª–æ–≤–µ–π", "–º–∏—Ä–Ω–æ")
                hero.defeat_boss("—Å–æ–ª–æ–≤–µ–π")
            
            elif isinstance(hero, Vasilisa):
                print("\n  –¢—ã —à–µ–ø—á–µ—à—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ...")
                print("  –¢–≤–æ—ë —Ç–µ–ª–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º!")
                print("  –°–æ–ª–æ–≤–µ–π –≤–µ—Ä—Ç–∏—Ç –≥–æ–ª–æ–≤–æ–π: ¬´–ö—É–¥–∞ –¥–µ–ª–∞—Å—å?!¬ª")
                print("\n  –¢—ã —Ç–∏—Ö–æ –æ–±—Ö–æ–¥–∏—à—å –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω–æ–π...")
                hero.set_npc_relation("—Å–æ–ª–æ–≤–µ–π", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                hero.defeat_boss("—Å–æ–ª–æ–≤–µ–π")
            
            elif isinstance(hero, Ivan):
                print("\n  ¬´–ü–µ—Å–Ω—é? ‚Äî –°–æ–ª–æ–≤–µ–π —É–¥–∏–≤–ª—ë–Ω. ‚Äî –ù—É –¥–∞–≤–∞–π!¬ª")
                print("  –¢—ã –∑–∞—Ç—è–≥–∏–≤–∞–µ—à—å –º–∞—Ç—É—à–∫–∏–Ω—É –∫–æ–ª—ã–±–µ–ª—å–Ω—É—é...")
                print("\n  –°–æ–ª–æ–≤–µ–π —Å–ª—É—à–∞–µ—Ç, –∫–ª—é–≤ –ø—Ä–∏–æ—Ç–∫—Ä—ã—Ç.")
                print("  ¬´–ö—Ä–∞—Å–∏–≤–æ...¬ª ‚Äî –æ–Ω –≤—ã—Ç–∏—Ä–∞–µ—Ç —Å–ª–µ–∑—É.")
                print("  ¬´–õ–∞–¥–Ω–æ, –ø—Ä–æ—Ö–æ–¥–∏. –•–æ—Ä–æ—à–∏–π —Ç—ã —á–µ–ª–æ–≤–µ–∫.¬ª")
                
                hero.set_npc_relation("—Å–æ–ª–æ–≤–µ–π", "–º–∏—Ä–Ω–æ")
                hero.defeat_boss("—Å–æ–ª–æ–≤–µ–π")
        
        return self._show_navigation(hero, result)
    
    def _show_navigation(self, hero: Hero, result: LocationResult) -> LocationResult:
        print("\n" + "‚îÄ" * 50)
        
        paths = [
            ("izbushka", "üèöÔ∏è –ö –∏–∑–±—É—à–∫–µ", "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ë–∞–±–µ-–Ø–≥–µ"),
            ("opushka", "üå≤ –ö —Ä–∞–∑–≤–∏–ª–∫–µ", "–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å"),
            ("serdce", "üíé –ö –°–µ—Ä–¥—Ü—É –ª–µ—Å–∞", f"–¢–∞–º —Å—É–Ω–¥—É–∫ (–∫–ª—é—á–µ–π: {hero.count_keys()}/3)"),
        ]
        
        result.next_location = show_navigation("ovrag", paths)
        game_manager.sync_from_hero(hero)
        return result


class Chasha(Location):
    """–¢—ë–º–Ω–∞—è —á–∞—â–∞ - –≤–ª–∞–¥–µ–Ω–∏—è –õ–µ—à–µ–≥–æ."""
    
    def __init__(self):
        super().__init__(
            "chasha",
            "üå≤ –¢–Å–ú–ù–ê–Ø –ß–ê–©–ê",
            """
    –õ–µ—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å—ë –≥—É—â–µ. –î–µ—Ä–µ–≤—å—è —Å–ø–ª–µ—Ç–∞—é—Ç—Å—è 
    –≤–µ—Ç–≤—è–º–∏ —Ç–∞–∫ –ø–ª–æ—Ç–Ω–æ, —á—Ç–æ –Ω–µ –≤–∏–¥–Ω–æ –Ω–µ–±–∞.
    
    –¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ –∑–∞–±–ª—É–¥–∏–ª—Å—è. –¢—Ä–æ–ø–∞ –∏—Å—á–µ–∑–ª–∞.
    –í–æ–∫—Ä—É–≥ ‚Äî —Ç–æ–ª—å–∫–æ –¥–µ—Ä–µ–≤—å—è, –º–æ—Ö –∏ —Ç—É–º–∞–Ω.
    
    –ò–∑ —Ç—É–º–∞–Ω–∞ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –æ–≥—Ä–æ–º–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ ‚Äî
    —á–µ–ª–æ–≤–µ–∫ –Ω–µ —á–µ–ª–æ–≤–µ–∫, –¥–µ—Ä–µ–≤–æ –Ω–µ –¥–µ—Ä–µ–≤–æ.
    –ì–ª–∞–∑–∞ –≥–æ—Ä—è—Ç –∑–µ–ª—ë–Ω—ã–º –æ–≥–Ω—ë–º.
    
    ¬´–ö—Ç–æ –ø–æ—Å–º–µ–ª –≤–æ–π—Ç–∏ –≤ –º–æ–π –ª–µ—Å?¬ª ‚Äî 
    –≥–æ–ª–æ—Å –∫–∞–∫ —Å–∫—Ä–∏–ø —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ç–≤–µ–π.
""",
            """
    –ß–∞—â–∞ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ç–µ–º–Ω–∞ –∏ –≥—É—Å—Ç–∞,
    –Ω–æ —Ç—ã —É–∂–µ –∑–Ω–∞–µ—à—å –¥–æ—Ä–æ–≥—É.
    –î–µ—Ä–µ–≤—å—è —Ä–∞—Å—Å—Ç—É–ø–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π.
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        result = super().enter(hero)
        
        if hero.is_boss_defeated("–ª–µ—à–∏–π"):
            relation = hero.get_npc_relation("–ª–µ—à–∏–π")
            
            if relation == "–º–∏—Ä–Ω–æ":
                print("\n  –î–µ—Ä–µ–≤—å—è —à–µ–ª–µ—Å—Ç—è—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.")
                print("  –õ–µ—à–∏–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏–∑ —Ç—É–º–∞–Ω–∞.")
                print("  ¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –ø—É—Ç–Ω–∏–∫. –õ–µ—Å –ø–æ–º–Ω–∏—Ç —Ç–µ–±—è.¬ª")
            else:
                print("\n  –õ–µ—Å –º–æ–ª—á–∏—Ç. –õ–µ—à–∏–π –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.")
            
            return self._show_navigation(hero, result)
        
        leshy = Leshy()
        
        print(f"\n  üå≤ –õ–ï–®–ò–ô ‚Äî —Ö–æ–∑—è–∏–Ω —á–∞—â–∏!")
        print(f"  (HP: {leshy.hp}, –°–∏–ª–∞: {leshy.strength})")
        
        print("\n  ¬´–ó–∞—á–µ–º –ø—Ä–∏—à—ë–ª –≤ –º–æ–π –ª–µ—Å, —á–µ–ª–æ–≤–µ—á–µ?¬ª")
        
        options = [
            "\n  1. üó£Ô∏è ¬´–ò—â—É —Å–æ–∫—Ä–æ–≤–∏—â–µ, —á—Ç–æ –≤ —Å–µ—Ä–¥—Ü–µ –ª–µ—Å–∞¬ª",
            "  2. ‚öîÔ∏è ¬´–ü—Ä–æ—á—å —Å –¥–æ—Ä–æ–≥–∏, –Ω–µ—á–∏—Å—Ç—å!¬ª",
            "  3. üôè ¬´–ü—Ä–æ—à—É –ø–æ–º–æ—â–∏, —Ö–æ–∑—è–∏–Ω –ª–µ—Å–∞¬ª"
        ]
        
        choice = show_choice("", options, 3)
        
        if choice == 1:
            print("\n  ¬´–°–æ–∫—Ä–æ–≤–∏—â–µ? ‚Äî –õ–µ—à–∏–π —É—Å–º–µ—Ö–∞–µ—Ç—Å—è. ‚Äî")
            print("  –ú–Ω–æ–≥–∏–µ –∏—Å–∫–∞–ª–∏. –ù–∏–∫—Ç–æ –Ω–µ –Ω–∞—à—ë–ª.¬ª")
            print("\n  ¬´–î–æ–∫–∞–∂–∏, —á—Ç–æ –¥–æ—Å—Ç–æ–∏–Ω. –ó–∞–≥–∞–¥–∫–∏ –æ—Ç–≥–∞–¥–∞–π!¬ª")
            
            correct = self._riddles(hero)
            
            if correct >= 2:
                print("\n  –õ–µ—à–∏–π –∫–∏–≤–∞–µ—Ç.")
                print("  ¬´–£–º—ë–Ω —Ç—ã, –ø—É—Ç–Ω–∏–∫. –ò–ª–∏ —Ö–∏—Ç—ë—Ä.¬ª")
                print("  ¬´–í–æ—Ç —Ç–µ–±–µ –∫–ª—é—á. –ò–¥–∏ —Å –º–∏—Ä–æ–º.¬ª")
                
                print(hero.add_artifact("kostyanoy_kluch"))
                hero.set_npc_relation("–ª–µ—à–∏–π", "–º–∏—Ä–Ω–æ")
                hero.defeat_boss("–ª–µ—à–∏–π")
            else:
                print("\n  ¬´–ì–ª—É–ø! ‚Äî –≥—Ä–µ–º–∏—Ç –õ–µ—à–∏–π. ‚Äî –õ–µ—Å –Ω–µ –ª—é–±–∏—Ç –≥–ª—É–ø—Ü–æ–≤!¬ª")
                victory, _ = boss_battle(hero, leshy)
                if not victory:
                    return LocationResult(game_over=True, victory=False)
                print(hero.add_artifact("kostyanoy_kluch"))
                hero.set_npc_relation("–ª–µ—à–∏–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
        
        elif choice == 2:
            print("\n  ¬´–ù–µ—á–∏—Å—Ç—å?! ‚Äî –õ–µ—à–∏–π —Ä–µ–≤—ë—Ç. ‚Äî")
            print("  –Ø ‚Äî –î–£–• –õ–ï–°–ê! –Ø ‚Äî –°–ê–ú–ê –ü–†–ò–†–û–î–ê!¬ª")
            print("  ¬´–£–º—Ä–∏, –Ω–µ–≤–µ–∂–¥–∞!¬ª")
            
            victory, _ = boss_battle(hero, leshy)
            if not victory:
                return LocationResult(game_over=True, victory=False)
            print(hero.add_artifact("kostyanoy_kluch"))
            hero.set_npc_relation("–ª–µ—à–∏–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
        
        else:  # –ü—Ä–æ—à—É –ø–æ–º–æ—â–∏
            print("\n  –õ–µ—à–∏–π —Å–º–æ—Ç—Ä–∏—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ...")
            
            if isinstance(hero, Ivan):
                print("  ¬´–í–∏–∂—É ‚Äî —Å–µ—Ä–¥—Ü–µ –¥–æ–±—Ä–æ–µ. –†–µ–¥–∫–æ—Å—Ç—å.¬ª")
                print("  ¬´–ò–¥—ë—à—å –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–µ–º, –Ω–æ –Ω–µ –¥–ª—è —Å–µ–±—è.¬ª")
                print("  ¬´–ü–æ–º–æ–≥—É —Ç–µ–±–µ, –¥–æ–±—Ä—ã–π —á–µ–ª–æ–≤–µ–∫.¬ª")
                
                print(hero.add_artifact("kostyanoy_kluch"))
                print(hero.add_artifact("dudochka"))
                hero.set_npc_relation("–ª–µ—à–∏–π", "–º–∏—Ä–Ω–æ")
                hero.defeat_boss("–ª–µ—à–∏–π")
                
            elif isinstance(hero, Vasilisa):
                print("  ¬´–ö–æ–ª–¥—É–Ω—å—è... –ù–æ –Ω–µ –∑–ª–∞—è.¬ª")
                print("  ¬´–û—Ç—Ü–∞ –∏—â–µ—à—å —Å–ø–∞—Å—Ç–∏? –ó–Ω–∞—é —è —ç—Ç—É –∏—Å—Ç–æ—Ä–∏—é.¬ª")
                print("  ¬´–ü–æ–º–æ–≥—É. –ù–æ —Å–Ω–∞—á–∞–ª–∞ ‚Äî –∑–∞–≥–∞–¥–∫–∏!¬ª")
                
                correct = self._riddles(hero)
                if correct >= 1:  # –õ–µ–≥—á–µ –¥–ª—è –í–∞—Å–∏–ª–∏—Å—ã
                    print(hero.add_artifact("kostyanoy_kluch"))
                    hero.set_npc_relation("–ª–µ—à–∏–π", "–º–∏—Ä–Ω–æ")
                    hero.defeat_boss("–ª–µ—à–∏–π")
                else:
                    victory, _ = boss_battle(hero, leshy)
                    if not victory:
                        return LocationResult(game_over=True, victory=False)
                    print(hero.add_artifact("kostyanoy_kluch"))
                    hero.set_npc_relation("–ª–µ—à–∏–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
            
            else:  # –°–ª—É–≥–∞
                print("  ¬´–ö–æ—â–µ–µ–≤ —Å–ª—É–≥–∞ –ø—Ä–æ—Å–∏—Ç –ø–æ–º–æ—â–∏?¬ª")
                print("  ¬´–•–º... –ß—É—é, —Ç—ã –∏–∑–º–µ–Ω–∏–ª—Å—è.¬ª")
                print("  ¬´–ù–æ –∑–∞–≥–∞–¥–∫–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–≥–∞–¥–∞–π!¬ª")
                
                correct = self._riddles(hero)
                if correct >= 2:
                    print(hero.add_artifact("kostyanoy_kluch"))
                    hero.set_npc_relation("–ª–µ—à–∏–π", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
                    hero.defeat_boss("–ª–µ—à–∏–π")
                else:
                    victory, _ = boss_battle(hero, leshy)
                    if not victory:
                        return LocationResult(game_over=True, victory=False)
                    print(hero.add_artifact("kostyanoy_kluch"))
                    hero.set_npc_relation("–ª–µ—à–∏–π", "–≤—Ä–∞–∂–¥–µ–±–Ω–æ")
        
        return self._show_navigation(hero, result)
    
    def _riddles(self, hero: Hero) -> int:
        """–ó–∞–≥–∞–¥–∫–∏ –õ–µ—à–µ–≥–æ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤."""
        correct = 0
        
        riddles = [
            ("¬´–ß—Ç–æ —Ä–∞—Å—Ç—ë—Ç –±–µ–∑ –∫–æ—Ä–Ω–µ–π?¬ª", 1, ["–ö–∞–º–µ–Ω—å", "–ì—Ä–∏–±", "–î–µ—Ä–µ–≤–æ"]),
            ("¬´–ö—Ç–æ —Ö–æ–¥–∏—Ç –±–µ–∑ –Ω–æ–≥?¬ª", 2, ["–ó–º–µ—è", "–†—ã–±–∞", "–ü—Ç–∏—Ü–∞"]),
            ("¬´–ß—Ç–æ –≤–∏–¥–∏—Ç –±–µ–∑ –≥–ª–∞–∑?¬ª", 3, ["–õ–µ—Ç—É—á–∞—è –º—ã—à—å", "–ö—Ä–æ—Ç", "–°–æ–≤–µ—Å—Ç—å"]),
        ]
        
        for question, answer, options in riddles:
            print(f"\n  {question}")
            for i, opt in enumerate(options, 1):
                print(f"  {i}. {opt}")
            
            if isinstance(hero, Vasilisa):
                print(f"\n  ‚ú® –í–∞—Å–∏–ª–∏—Å–∞ –∑–Ω–∞–µ—Ç –æ—Ç–≤–µ—Ç: {options[answer-1]}")
                correct += 1
            else:
                ans = get_input_with_menu(
                    "  –û—Ç–≤–µ—Ç: ", range(1, 4),
                    question, [f"  {i}. {o}" for i, o in enumerate(options, 1)]
                )
                if ans == answer:
                    print("  ‚úÖ –í–µ—Ä–Ω–æ!")
                    correct += 1
                else:
                    print(f"  ‚ùå –ù–µ–≤–µ—Ä–Ω–æ... –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {options[answer-1]}")
        
        print(f"\n  –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {correct}/3")
        return correct
    
    def _show_navigation(self, hero: Hero, result: LocationResult) -> LocationResult:
        print("\n" + "‚îÄ" * 50)
        
        paths = [
            ("opushka", "üå≤ –ö —Ä–∞–∑–≤–∏–ª–∫–µ", "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—á–∞–ª—É"),
            ("serdce", "üíé –ö –°–µ—Ä–¥—Ü—É –ª–µ—Å–∞", f"–¢–∞–º —Å—É–Ω–¥—É–∫ (–∫–ª—é—á–µ–π: {hero.count_keys()}/3)"),
        ]
        
        result.next_location = show_navigation("chasha", paths)
        game_manager.sync_from_hero(hero)
        return result


class TemnayaTropa(Location):
    """–¢–∞–π–Ω–∞—è —Ç—Ä–æ–ø–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª—É–≥–∏ –ö–æ—â–µ—è."""
    
    def __init__(self):
        super().__init__(
            "temnaya_tropa",
            "üï≥Ô∏è –¢–ê–ô–ù–ê–Ø –¢–†–û–ü–ê",
            """
    –¢–µ–Ω–∏ —Å–≥—É—â–∞—é—Ç—Å—è –≤–æ–∫—Ä—É–≥ —Ç–µ–±—è. –ü–µ—Ä—Å—Ç–µ–Ω—å –Ω–∞ –ø–∞–ª—å—Ü–µ
    —Ö–æ–ª–æ–¥–µ–µ—Ç, –∏ —Ç—ã –≤–∏–¥–∏—à—å ‚Äî –≤ —Ç–µ–º–Ω–æ—Ç–µ –µ—Å—Ç—å –ø—É—Ç—å.
    
    –¢—Ä–æ–ø–∞, –∫–æ—Ç–æ—Ä—É—é –Ω–µ –≤–∏–¥–∏—Ç –Ω–∏–∫—Ç–æ, –∫—Ä–æ–º–µ —Å–ª—É–≥ –ö–æ—â–µ—è.
    –û–Ω–∞ –≤–µ–¥—ë—Ç —Å–∫–≤–æ–∑—å –∏–∑–Ω–∞–Ω–∫—É –ª–µ—Å–∞, –º–∏–º–æ –≤—Å–µ—Ö –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π...
    
    –ù–æ –∑–¥–µ—Å—å –≤–æ–¥–∏—Ç—Å—è –∫–æ–µ-—á—Ç–æ –ø–æ—Ö—É–∂–µ –∂–∏–≤—ã—Ö –≤—Ä–∞–≥–æ–≤.
""",
            """
    –¢–∞–π–Ω–∞—è —Ç—Ä–æ–ø–∞ –≤—Å—ë —Ç–∞–∫ –∂–µ —Å–∫—Ä—ã—Ç–∞ –≤ —Ç–µ–Ω—è—Ö.
    –¢—ã –∑–Ω–∞–µ—à—å —ç—Ç–æ—Ç –ø—É—Ç—å ‚Äî –æ–Ω –æ–ø–∞—Å–µ–Ω, –Ω–æ –∫–æ—Ä–æ—Ç–æ–∫.
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        result = super().enter(hero)
        
        if not isinstance(hero, Sluga):
            print("\n  ‚ö†Ô∏è –¢–µ–Ω–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç —Ç–µ–±—è –Ω–∞–∑–∞–¥!")
            print("  –≠—Ç–æ—Ç –ø—É—Ç—å –Ω–µ –¥–ª—è —Ç–µ–±—è...")
            result.next_location = "opushka"
            return result
        
        print("\n  –ü–µ—Ä—Å—Ç–µ–Ω—å –ø—É–ª—å—Å–∏—Ä—É–µ—Ç, —É–∫–∞–∑—ã–≤–∞—è –ø—É—Ç—å.")
        print("  –¢—ã –∏–¥—ë—à—å —Å–∫–≤–æ–∑—å —Ç–µ–Ω–∏...")
        
        if not hero.is_boss_defeated("—É–ø—ã—Ä—å"):
            print("\n  –í–Ω–µ–∑–∞–ø–Ω–æ –∏–∑ —Ç–µ–º–Ω–æ—Ç—ã –≤—ã—Å–∫–∞–∫–∏–≤–∞–µ—Ç –£–ü–´–†–¨!")
            print("  –û–Ω –≥–æ–ª–æ–¥–µ–Ω –∏ –±–µ–∑—É–º–µ–Ω!")
            
            upyr = Upyr()
            victory, _ = battle(hero, upyr, can_flee=False)
            
            if not victory:
                return LocationResult(game_over=True, victory=False)
            
            print("\n  –£–ø—ã—Ä—å —Ä–∞—Å—Å—ã–ø–∞–µ—Ç—Å—è –≤ –ø—Ä–∞—Ö.")
        else:
            print("\n  –¢–∞–º, –≥–¥–µ –±—ã–ª —É–ø—ã—Ä—å ‚Äî —Ç–æ–ª—å–∫–æ –ø—ã–ª—å.")
        
        # –¢–∞–π–Ω–∏–∫ –ö–æ—â–µ—è
        print("\n  –í –∫–æ–Ω—Ü–µ —Ç—Ä–æ–ø—ã ‚Äî —Ç–∞–π–Ω–∏–∫!")
        print("  –ó–¥–µ—Å—å –ö–æ—â–µ–π —Ö—Ä–∞–Ω–∏–ª –∑–∞–ø–∞—Å–Ω—ã–µ –∫–ª—é—á–∏...")
        print("  –ò –∫–æ–µ-—á—Ç–æ –µ—â—ë.")
        
        if not hero.has_artifact("zolotoy_kluch"):
            print(hero.add_artifact("zolotoy_kluch"))
        if not hero.has_artifact("serebryany_kluch"):
            print(hero.add_artifact("serebryany_kluch"))
        if not hero.has_artifact("kostyanoy_kluch"):
            print(hero.add_artifact("kostyanoy_kluch"))
        if not hero.has_artifact("mech"):
            print(hero.add_artifact("mech"))
        
        # –ë–æ–Ω—É—Å –∫ —Å–∏–ª–µ –æ—Ç –º–µ—á–∞
        hero.strength += 5
        print("  ‚öîÔ∏è –ú–µ—á-–∫–ª–∞–¥–µ–Ω–µ—Ü –¥–∞—ë—Ç +5 –∫ —Å–∏–ª–µ!")
        
        print("\n" + "‚îÄ" * 50)
        print("\n  –¢–∞–π–Ω–∞—è —Ç—Ä–æ–ø–∞ –≤–µ–¥—ë—Ç –ø—Ä—è–º–æ –∫ –°–µ—Ä–¥—Ü—É –ª–µ—Å–∞.")
        
        input("\n  [Enter ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å]")
        result.next_location = "serdce"
        game_manager.sync_from_hero(hero)
        return result


class Serdce(Location):
    """–°–µ—Ä–¥—Ü–µ –ª–µ—Å–∞ - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è."""
    
    def __init__(self):
        super().__init__(
            "serdce",
            "üíé –°–ï–†–î–¶–ï –ó–ê–ü–û–í–ï–î–ù–û–ì–û –õ–ï–°–ê",
            """
    –î–µ—Ä–µ–≤—å—è —Ä–∞—Å—Å—Ç—É–ø–∞—é—Ç—Å—è, –æ—Ç–∫—Ä—ã–≤–∞—è –ø–æ–ª—è–Ω—É, 
    –∑–∞–ª–∏—Ç—É—é —Å—Ç—Ä–∞–Ω–Ω—ã–º —Å–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–º —Å–≤–µ—Ç–æ–º.
    
    –í —Ü–µ–Ω—Ç—Ä–µ ‚Äî –¥—Ä–µ–≤–Ω–∏–π –¥—É–±, –æ–≥—Ä–æ–º–Ω—ã–π –∫–∞–∫ –±–∞—à–Ω—è.
    –ü–æ–¥ –Ω–∏–º ‚Äî –∫–∞–º–µ–Ω–Ω—ã–π —Å—É–Ω–¥—É–∫ —Å —Ç—Ä–µ–º—è –∑–∞–º–∫–∞–º–∏.
    
    –ó–æ–ª–æ—Ç–æ–π. –°–µ—Ä–µ–±—Ä—è–Ω—ã–π. –ö–æ—Å—Ç—è–Ω–æ–π.
    
    –í–æ–∑–¥—É—Ö –¥—Ä–æ–∂–∏—Ç –æ—Ç –º–∞–≥–∏–∏. –ó–¥–µ—Å—å –æ–Ω–æ ‚Äî —Å–æ–∫—Ä–æ–≤–∏—â–µ!
""",
            """
    –°–µ—Ä–¥—Ü–µ –ª–µ—Å–∞. –ü–æ–ª—è–Ω–∞ –∑–∞–ª–∏—Ç–∞ —Å–≤–µ—Ç–æ–º.
    –°—É–Ω–¥—É–∫ –∂–¥—ë—Ç —Å–≤–æ–µ–≥–æ —á–∞—Å–∞.
"""
        )
    
    def enter(self, hero: Hero) -> LocationResult:
        result = super().enter(hero)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π
        keys_count = hero.count_keys()
        print(f"\n  üîë –£ —Ç–µ–±—è –∫–ª—é—á–µ–π: {keys_count}/3")
        
        if hero.has_artifact("zolotoy_kluch"):
            print("    ‚úÖ –ó–æ–ª–æ—Ç–æ–π –∫–ª—é—á")
        else:
            print("    ‚ùå –ó–æ–ª–æ—Ç–æ–π –∫–ª—é—á (–Ω–µ—Ç)")
        
        if hero.has_artifact("serebryany_kluch"):
            print("    ‚úÖ –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫–ª—é—á")
        else:
            print("    ‚ùå –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫–ª—é—á (–Ω–µ—Ç)")
        
        if hero.has_artifact("kostyanoy_kluch"):
            print("    ‚úÖ –ö–æ—Å—Ç—è–Ω–æ–π –∫–ª—é—á")
        else:
            print("    ‚ùå –ö–æ—Å—Ç—è–Ω–æ–π –∫–ª—é—á (–Ω–µ—Ç)")
        
        if keys_count < 3:
            print("\n  ‚ö†Ô∏è –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–ª—é—á–µ–π!")
            print("  –°—É–Ω–¥—É–∫ –Ω–µ –æ—Ç–∫—Ä—ã—Ç—å...")
            
            # –ò–≤–∞–Ω –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É–¥–∞—á—É
            if isinstance(hero, Ivan) and hero.can_use_ability():
                print("\n  üçÄ –ú–æ–∂–µ—Ç, –∞–≤–æ—Å—å –ø–æ–º–æ–∂–µ—Ç?")
                print("\n  1. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É–¥–∞—á—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)")
                print("  2. –í–µ—Ä–Ω—É—Ç—å—Å—è –∑–∞ –∫–ª—é—á–∞–º–∏")
                
                choice = get_input_with_menu("\n  –í—ã–±–æ—Ä: ", range(1, 3))
                
                if choice == 1:
                    print(hero.use_ability(2))  # –ê–≤–æ—Å—å
                    if random.random() < 0.3:
                        print("\n  üçÄ –ù–ï–í–ï–†–û–Ø–¢–ù–û!")
                        print("  –ó–∞–º–∫–∏ —â—ë–ª–∫–∞—é—Ç —Å–∞–º–∏ —Å–æ–±–æ–π!")
                        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ –±–æ—Å—Å—É
                    else:
                        print("\n  üòî –ù–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ...")
                        return self._show_navigation_back(hero, result)
                else:
                    return self._show_navigation_back(hero, result)
            else:
                return self._show_navigation_back(hero, result)
        
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—É–Ω–¥—É–∫
        print("\n  –¢—ã –≤—Å—Ç–∞–≤–ª—è–µ—à—å –∫–ª—é—á–∏ –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º...")
        print("  –©–Å–õ–ö! –©–Å–õ–ö! –©–Å–õ–ö!")
        print("\n  –ö—Ä—ã—à–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è...")
        
        # –§–ò–ù–ê–õ–¨–ù–´–ô –ë–û–°–°
        print("\n  üíÄ –ó–ï–ú–õ–Ø –°–û–î–†–û–ì–ê–ï–¢–°–Ø!")
        print("\n  –ò–∑ —Å—É–Ω–¥—É–∫–∞ –≤—ã—Ä—ã–≤–∞–µ—Ç—Å—è —Ç—å–º–∞!")
        print("  –û–Ω–∞ —Å–≥—É—â–∞–µ—Ç—Å—è –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫—É—é —Ñ–∏–≥—É—Ä—É...")
        print("\n  ¬´–ù–ò–ö–¢–û! –ù–ï –¢–†–û–ù–ï–¢! –ú–û–Å –°–û–ö–†–û–í–ò–©–ï!¬ª")
        print("\n  –¢–ï–ù–¨ –ö–û–©–ï–Ø –≤–æ—Å—Å—Ç–∞—ë—Ç!")
        
        shadow = ShadowKoschei()
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
        print("\n  üìú –ë–û–ù–£–°–´ –û–¢ –ê–†–¢–ï–§–ê–ö–¢–û–í:")
        
        if hero.has_artifact("mech"):
            print("  ‚öîÔ∏è –ú–µ—á-–∫–ª–∞–¥–µ–Ω–µ—Ü —Å–∏—è–µ—Ç –ø—Ä–∞–≤–µ–¥–Ω—ã–º —Å–≤–µ—Ç–æ–º!")
            hero.strength += 7  # –ï—â—ë +7 –ø—Ä–æ—Ç–∏–≤ —Ç–µ–Ω–∏
        
        if hero.has_artifact("yayco"):
            print("  ü•ö –Ø–π—Ü–æ –°–æ–ª–æ–≤—å—è –æ—Å–ª–∞–±–ª—è–µ—Ç —Ç–µ–Ω—å!")
            shadow.hp -= 25
            shadow.strength -= 3
        
        if hero.has_artifact("dudochka"):
            print("  üéµ –î—É–¥–æ—á–∫–∞ –ø—Ä–∏–∑—ã–≤–∞–µ—Ç –¥—É—Ö–æ–≤ –ª–µ—Å–∞!")
            shadow.hp -= 20
        
        if hero.has_artifact("zerkalce"):
            print("  ü™û –ó–µ—Ä–∫–∞–ª—å—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–∞–±–æ—Å—Ç–∏ —Ç–µ–Ω–∏!")
            shadow.agility -= 8
        
        if hero.has_artifact("voda_zhizni"):
            print("  üíß –ñ–∏–≤–∞—è –≤–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ —Å–∏–ª—ã!")
            hero.hp = hero.max_hp
            if hasattr(hero, 'mp'):
                hero.mp = hero.max_mp
        
        # –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –±–æ–µ–º
        if not hero.has_artifact("voda_zhizni"):
            heal = hero.max_hp - hero.hp
            if heal > 0:
                hero.hp = hero.max_hp
                print(f"\n  üíö –°–∏–ª—ã –ª–µ—Å–∞ –ø–æ–º–æ–≥–∞—é—Ç: +{heal} HP")
            if hasattr(hero, 'mp'):
                hero.mp = hero.max_mp
                print(f"  üíô –ú–∞–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!")
        
        print(f"\n  üë§ –¢–µ–Ω—å –ö–æ—â–µ—è (HP: {shadow.hp}, –°–∏–ª–∞: {shadow.strength})")
        
        input("\n  [Enter ‚Äî –Ω–∞—á–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–æ–π!]")
        
        # –§–ò–ù–ê–õ–¨–ù–´–ô –ë–û–ô
        victory, _ = boss_battle(hero, shadow, "\n  ‚öîÔ∏è –§–ò–ù–ê–õ–¨–ù–ê–Ø –ë–ò–¢–í–ê!")
        
        if not victory:
            result.game_over = True
            result.victory = False
            return result
        
        # –ü–û–ë–ï–î–ê!
        self._victory_ending(hero, result)
        return result
    
    def _show_navigation_back(self, hero: Hero, result: LocationResult) -> LocationResult:
        """–ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ –∑–∞ –∫–ª—é—á–∞–º–∏."""
        print("\n" + "‚îÄ" * 50)
        print("\n  –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–ª—é—á–∏!")
        
        paths = []
        
        if not hero.has_artifact("zolotoy_kluch"):
            paths.append(("omut", "üíß –ö –¢—ë–º–Ω–æ–º—É –æ–º—É—Ç—É", "–ó–æ–ª–æ—Ç–æ–π –∫–ª—é—á —É –í–æ–¥—è–Ω–æ–≥–æ"))
        
        if not hero.has_artifact("serebryany_kluch"):
            paths.append(("izbushka", "üèöÔ∏è –ö –ò–∑–±—É—à–∫–µ", "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫–ª—é—á —É –ë–∞–±—ã-–Ø–≥–∏"))
        
        if not hero.has_artifact("kostyanoy_kluch"):
            paths.append(("chasha", "üå≤ –í –¢—ë–º–Ω—É—é —á–∞—â—É", "–ö–æ—Å—Ç—è–Ω–æ–π –∫–ª—é—á —É –õ–µ—à–µ–≥–æ"))
        
        paths.append(("opushka", "üå≤ –ö —Ä–∞–∑–≤–∏–ª–∫–µ", "–í—ã–±—Ä–∞—Ç—å –ø—É—Ç—å"))
        
        result.next_location = show_navigation("serdce", paths)
        game_manager.sync_from_hero(hero)
        return result
    
    def _victory_ending(self, hero: Hero, result: LocationResult):
        """–ö–æ–Ω—Ü–æ–≤–∫–∞ –ø–æ–±–µ–¥—ã."""
        result.game_over = True
        result.victory = True
        result.path_taken = hero.path_taken
        
        print("\n" + "üèÜ" * 30)
        print("\n  –¢–ï–ù–¨ –†–ê–°–°–ï–ò–í–ê–ï–¢–°–Ø –° –í–û–ï–ú!")
        print("\n" + "üèÜ" * 30)
        
        print("\n  –°—É–Ω–¥—É–∫ –Ω–∞–∫–æ–Ω–µ—Ü –æ—Ç–∫—Ä—ã—Ç.")
        print("  –í–Ω—É—Ç—Ä–∏ ‚Äî –≥–æ—Ä—ã –∑–æ–ª–æ—Ç–∞, –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ –∫–∞–º–Ω–∏...")
        print("  –ò –Ω–µ—á—Ç–æ –±–æ–ª—å—à–µ–µ.")
        
        if isinstance(hero, Ivan):
            print("""
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    ü§™ –ö–û–ù–¶–û–í–ö–ê –ò–í–ê–ù–ê-–î–£–†–ê–ö–ê
    
    –ò–≤–∞–Ω –¥–æ–ª–≥–æ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞.
    –ü–æ—Ç–æ–º —á–µ—à–µ—Ç –∑–∞—Ç—ã–ª–æ–∫ –∏ —É–ª—ã–±–∞–µ—Ç—Å—è.
    
    ¬´–≠—Ö... –î–∞ –Ω–∞ —á—Ç–æ –º–Ω–µ —ç—Ç–æ –≤—Å—ë?¬ª
    
    –û–Ω –±–µ—Ä—ë—Ç –æ–¥–Ω—É –∑–æ–ª–æ—Ç—É—é –º–æ–Ω–µ—Ç–∫—É ‚Äî
    –∫—É–ø–∏—Ç—å –º–∞—Ç—É—à–∫–µ –Ω–æ–≤—ã–π –ø–ª–∞—Ç–æ–∫.
    –ò —Å—Ç–∞—Ä—É—é –∫–Ω–∏–≥—É ‚Äî –º–æ–∂–µ—Ç, –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è.
    
    –í—Å–∫–æ—Ä–µ –º–æ–ª–≤–∞ –æ –¥–æ–±—Ä–æ–º –ò–≤–∞–Ω–µ —Ä–∞–∑–Ω–µ—Å–ª–∞—Å—å –ø–æ –≤—Å–µ–º—É
    —Ü–∞—Ä—Å—Ç–≤—É. –°–∞–º —Ü–∞—Ä—å –ø—Ä–∏–≥–ª–∞—Å–∏–ª –µ–≥–æ –≤–æ –¥–≤–æ—Ä–µ—Ü.
    
    –ê —Ç–∞–º –±—ã–ª–∞ —Ü–∞—Ä–µ–≤–Ω–∞... –ò –æ–Ω–∞ —É–ª—ã–±–Ω—É–ª–∞—Å—å –ò–≤–∞–Ω—É.
    
    –ò –∂–∏–ª–∏ –æ–Ω–∏ –¥–æ–ª–≥–æ –∏ —Å—á–∞—Å—Ç–ª–∏–≤–æ!
    
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
""")
        
        elif isinstance(hero, Vasilisa):
            print("""
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    ‚ú® –ö–û–ù–¶–û–í–ö–ê –í–ê–°–ò–õ–ò–°–´ –ü–†–ï–ú–£–î–†–û–ô
    
    –°—Ä–µ–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â –í–∞—Å–∏–ª–∏—Å–∞ –Ω–∞—Ö–æ–¥–∏—Ç –µ–≥–æ ‚Äî
    –°–≤–∏—Ç–æ–∫ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è, —Å–≤–µ—Ç—è—â–∏–π—Å—è –º—è–≥–∫–∏–º —Å–≤–µ—Ç–æ–º.
    
    –ù–µ –º–µ–¥–ª—è –Ω–∏ –º–∏–Ω—É—Ç—ã, –æ–Ω–∞ —Å–ø–µ—à–∏—Ç –¥–æ–º–æ–π.
    
    –û—Ç–µ—Ü —Å—Ç–æ–∏—Ç –≤–æ –¥–≤–æ—Ä–µ ‚Äî –∫–∞–º–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç—É—è,
    –ø–æ–∫—Ä—ã—Ç–∞—è –º—Ö–æ–º –∏ –ø–∞—É—Ç–∏–Ω–æ–π.
    
    –í–∞—Å–∏–ª–∏—Å–∞ —á–∏—Ç–∞–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ...
    –ö–∞–º–µ–Ω—å —Ç—Ä–µ—Å–∫–∞–µ—Ç—Å—è! –û—Ç–µ—Ü –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞!
    
    ¬´–î–æ—á–∫–∞... –¢—ã —Å–ø–∞—Å–ª–∞ –º–µ–Ω—è...¬ª
    
    –û–Ω–∏ –æ–±–Ω–∏–º–∞—é—Ç—Å—è, –∏ —Å–ª—ë–∑—ã —Ç–µ–∫—É—Ç –ø–æ —â–µ–∫–∞–º –æ–±–æ–∏—Ö.
    
    –í–∞—Å–∏–ª–∏—Å–∞ —Å—Ç–∞–ª–∞ –≤–µ–ª–∏—á–∞–π—à–µ–π –≤–æ–ª—à–µ–±–Ω–∏—Ü–µ–π —Ü–∞—Ä—Å—Ç–≤–∞,
    –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–±—ã–≤–∞–ª–∞ –≥–ª–∞–≤–Ω–æ–≥–æ ‚Äî
    –ª—é–±–æ–≤—å —Å–∏–ª—å–Ω–µ–µ –ª—é–±–æ–π –º–∞–≥–∏–∏.
    
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
""")
        
        else:  # –°–ª—É–≥–∞
            print("""
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    üó°Ô∏è –ö–û–ù–¶–û–í–ö–ê –ö–û–©–ï–ï–í–ê –°–õ–£–ì–ò
    
    –¢—ã —Å—Ç–æ–∏—à—å –Ω–∞–¥ –≥—Ä—É–¥–æ–π —Å–æ–∫—Ä–æ–≤–∏—â.
    –î–µ—Å—è—Ç—å –ª–µ—Ç —Ä–∞–±—Å—Ç–≤–∞ ‚Äî –∏ –≤–æ—Ç –æ–Ω–∞, —Å–≤–æ–±–æ–¥–∞.
    
    –ü–µ—Ä—Å—Ç–µ–Ω—å –Ω–∞ –ø–∞–ª—å—Ü–µ –≤–¥—Ä—É–≥ —Ä–∞—Å–∫–∞–ª—è–µ—Ç—Å—è!
    –ö–æ—â–µ–π —á—É–≤—Å—Ç–≤—É–µ—Ç —Ç–≤–æ—ë –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ!
    
    –¢—ã —Å—Ä—ã–≤–∞–µ—à—å –ø–µ—Ä—Å—Ç–µ–Ω—å –∏ —à–≤—ã—Ä—è–µ—à—å –≤ —Å—É–Ω–¥—É–∫.
    –û–Ω –ø–ª–∞–≤–∏—Ç—Å—è, —à–∏–ø—è –ø—Ä–æ–∫–ª—è—Ç–∏—è–º–∏.
    
    –£—Ö–æ–¥–∏—à—å –∏–∑ –ª–µ—Å–∞ –Ω–∞–ª–µ–≥–∫–µ.
    –ë–µ–∑ –∑–æ–ª–æ—Ç–∞. –ë–µ–∑ –º–∞–≥–∏–∏. –ë–µ–∑ —Ö–æ–∑—è–∏–Ω–∞.
    
    –ü—Ä–æ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω—ã–π —á–µ–ª–æ–≤–µ–∫.
    
    –ò —ç—Ç–æ ‚Äî —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ.
    
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
""")
        
        print(f"\n  üéÆ –ò–ì–†–ê –ü–†–û–ô–î–ï–ù–ê!")
        print(f"  üìä –ü—É—Ç—å: {hero.path_taken}")
        print(f"  üèÜ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ–±—Ä–∞–Ω–æ: {len(hero.artifacts)}")


# –†–µ–µ—Å—Ç—Ä –ª–æ–∫–∞—Ü–∏–π
LOCATIONS: Dict[str, Location] = {
    "opushka": Opushka(),
    "omut": Omut(),
    "izbushka": Izbushka(),
    "ovrag": Ovrag(),
    "chasha": Chasha(),
    "temnaya_tropa": TemnayaTropa(),
    "serdce": Serdce()
}


def get_location(location_id: str) -> Optional[Location]:
    return LOCATIONS.get(location_id)
