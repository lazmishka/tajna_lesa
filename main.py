import sys
import os

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from heroes import create_hero, get_class_description, Ivan, Vasilisa
from locations import get_location
from game_state import game_manager


def clear_screen():
    """–û—á–∏—Å—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞."""
    os.system('cls' if os.name == 'nt' else 'clear')


def show_title():
    """–ó–∞—Å—Ç–∞–≤–∫–∞ –∏–≥—Ä—ã."""
    print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë      üå≤üå≤üå≤   –¢–ê–ô–ù–ê –ó–ê–ü–û–í–ï–î–ù–û–ì–û –õ–ï–°–ê   üå≤üå≤üå≤                ‚ïë
‚ïë                                                              ‚ïë
‚ïë                                                              ‚ïë
‚ïë                                                              ‚ïë
‚ïë      –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–≤–µ—Å—Ç –ø–æ –º–æ—Ç–∏–≤–∞–º —Ä—É—Å—Å–∫–∏—Ö —Å–∫–∞–∑–æ–∫               ‚ïë
‚ïë                                                              ‚ïë
‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –í —Ç—Ä–∏–¥–µ–≤—è—Ç–æ–º —Ü–∞—Ä—Å—Ç–≤–µ, –≤ —Ç—Ä–∏–¥–µ—Å—è—Ç–æ–º –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ              ‚ïë
‚ïë  —Å—Ç–æ–∏—Ç –ó–∞–ø–æ–≤–µ–¥–Ω—ã–π –õ–µ—Å. –ì–æ–≤–æ—Ä—è—Ç, –≤ —Å–∞–º–æ–º –µ–≥–æ —Å–µ—Ä–¥—Ü–µ           ‚ïë
‚ïë  —Å–ø—Ä—è—Ç–∞–Ω–æ –Ω–µ—Å–º–µ—Ç–Ω–æ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ...                             ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –¢—Ä–∏ –∫–ª—é—á–∞. –¢—Ä–∏ –∑–∞–º–∫–∞. –¢—Ä–∏ –ø—É—Ç–∏.                             ‚ïë
‚ïë  –ö–∞–∫–æ–π –≤—ã–±–µ—Ä–µ—à—å —Ç—ã?                                          ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
""")


def login_menu() -> bool:
    """–ú–µ–Ω—é –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É."""
    
    print("\n  üë§ –í–•–û–î –í –ò–ì–†–£")
    print("‚ïê" * 50)
    print("\n  1. –í–æ–π—Ç–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç")
    print("  2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç")
    print("  3. –í—ã—Ö–æ–¥ –∏–∑ –∏–≥—Ä—ã")
    
    while True:
        try:
            choice = int(input("\n  –í—ã–±–µ—Ä–∏—Ç–µ: "))
            
            if choice == 1:
                name = input("\n  –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ").strip()
                if not name:
                    print("  ‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∏–º—è!")
                    continue
                
                password = input("  –ü–∞—Ä–æ–ª—å: ").strip()
                
                if game_manager.login(name, password):
                    print(f"\n  ‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {name}!")
                    return True
                else:
                    print("  ‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å!")
            
            elif choice == 2:
                print("\n  üìù –°–û–ó–î–ê–ù–ò–ï –ê–ö–ö–ê–£–ù–¢–ê")
                name = input("  –ò–º—è (–ª–∞—Ç–∏–Ω–∏—Ü–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤): ").strip()
                if not name:
                    print("  ‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∏–º—è!")
                    continue
                
                if game_manager.account_exists(name):
                    print("  ‚ö†Ô∏è –¢–∞–∫–æ–π –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!")
                    continue
                
                password = input("  –ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞): ").strip()
                if len(password) < 3:
                    print("  ‚ö†Ô∏è –ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π!")
                    continue
                
                password2 = input("  –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å: ").strip()
                if password != password2:
                    print("  ‚ö†Ô∏è –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!")
                    continue
                
                if game_manager.create_account(name, password):
                    print(f"\n  ‚úÖ –ê–∫–∫–∞—É–Ω—Ç ¬´{name}¬ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!")
                    return True
                else:
                    print("  ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞!")
            
            elif choice == 3:
                return False
            
            else:
                print("  ‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ 1, 2 –∏–ª–∏ 3")
        
        except ValueError:
            print("  ‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")


def main_menu() -> str:
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–≥—Ä—ã."""
    
    print("\n" + "‚ïê" * 50)
    print(f"  üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ")
    print(f"  –ò–≥—Ä–æ–∫: {game_manager.account_name}")
    print("‚ïê" * 50)
    
    options = []
    actions = []
    
    options.append("üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞")
    actions.append("new")
    
    if game_manager.has_saved_game():
        options.append("üìÇ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∏–≥—Ä—É")
        actions.append("continue")
    
    options.append("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π")
    actions.append("stats")
    
    options.append("‚ùì –ö–∞–∫ –∏–≥—Ä–∞—Ç—å")
    actions.append("help")
    
    options.append("üö™ –í—ã—Ö–æ–¥")
    actions.append("quit")
    
    for i, opt in enumerate(options, 1):
        print(f"\n  {i}. {opt}")
    
    print("\n" + "‚ïê" * 50)
    
    while True:
        try:
            choice = int(input("\n  –í—ã–±–µ—Ä–∏—Ç–µ: "))
            if 1 <= choice <= len(options):
                return actions[choice - 1]
            print(f"  ‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç 1 –¥–æ {len(options)}")
        except ValueError:
            print("  ‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")


def show_help():
    """–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏–≥—Ä–µ."""
    print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                      üìñ –ö–ê–ö –ò–ì–†–ê–¢–¨                           ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                              ‚ïë
‚ïë  üéØ –¶–ï–õ–¨ –ò–ì–†–´:                                               ‚ïë
‚ïë     –ù–∞–π—Ç–∏ —Ç—Ä–∏ –∫–ª—é—á–∞ –∏ –æ—Ç–∫—Ä—ã—Ç—å —Å—É–Ω–¥—É–∫ –≤ –°–µ—Ä–¥—Ü–µ –ª–µ—Å–∞.         ‚ïë
‚ïë     –£ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ‚Äî —Å–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è –∏ –∫–æ–Ω—Ü–æ–≤–∫–∞.          ‚ïë
‚ïë                                                              ‚ïë
‚ïë  üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï:                                              ‚ïë
‚ïë     ‚Ä¢ –í–≤–æ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è                      ‚ïë
‚ïë     ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ 0 –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ú–ï–ù–Æ             ‚ïë
‚ïë     ‚Ä¢ –í –º–µ–Ω—é –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –∑–∞–≥—Ä—É–∑–∏—Ç—å, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å  ‚ïë
‚ïë                                                              ‚ïë
‚ïë  ‚öîÔ∏è –ë–û–ô:                                                     ‚ïë
‚ïë     1. –ê—Ç–∞–∫–∞ ‚Äî –±–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–ª—ã)               ‚ïë
‚ïë     2. –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å ‚Äî –º–æ—â–Ω—ã–µ —É–º–µ–Ω–∏—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã!)            ‚ïë
‚ïë     3. –ü—Ä–µ–¥–º–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–µ–ª—å–µ –∏–ª–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç            ‚ïë
‚ïë     4. –ü–æ–±–µ–≥ ‚Äî —à–∞–Ω—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–æ–≤–∫–æ—Å—Ç–∏                     ‚ïë
‚ïë                                                              ‚ïë
‚ïë  üîë –¢–†–ò –ö–õ–Æ–ß–ê:                                               ‚ïë
‚ïë     ‚Ä¢ –ó–æ–ª–æ—Ç–æ–π ‚Äî —É –í–æ–¥—è–Ω–æ–≥–æ –≤ –¢—ë–º–Ω–æ–º –æ–º—É—Ç–µ                   ‚ïë
‚ïë     ‚Ä¢ –°–µ—Ä–µ–±—Ä—è–Ω—ã–π ‚Äî —É –ë–∞–±—ã-–Ø–≥–∏ –≤ –ò–∑–±—É—à–∫–µ                     ‚ïë
‚ïë     ‚Ä¢ –ö–æ—Å—Ç—è–Ω–æ–π ‚Äî —É –õ–µ—à–µ–≥–æ –≤ –¢—ë–º–Ω–æ–π —á–∞—â–µ                     ‚ïë
‚ïë                                                              ‚ïë
‚ïë  ‚ö†Ô∏è –í–ê–ñ–ù–û:                                                   ‚ïë
‚ïë     ‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–¥–∞–≤–∞–π—Ç–µ –∫–ª—é—á–∏! –≠—Ç–æ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ!            ‚ïë
‚ïë     ‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ—Å—å –ø–µ—Ä–µ–¥ –æ–ø–∞—Å–Ω—ã–º–∏ –º–µ—Å—Ç–∞–º–∏!                  ‚ïë
‚ïë     ‚Ä¢ –£ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ ‚Äî —Å–≤–æ–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏        ‚ïë
‚ïë                                                              ‚ïë
‚ïë  üí° –ü–û–î–°–ö–ê–ó–ö–ò:                                               ‚ïë
‚ïë     ‚Ä¢ –ò–≤–∞–Ω ‚Äî –¥–æ–±—Ä–æ—Ç–∞ –∏ —É–¥–∞—á–∞ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –º–∏—Ä–Ω—ã–µ –ø—É—Ç–∏          ‚ïë
‚ïë     ‚Ä¢ –í–∞—Å–∏–ª–∏—Å–∞ ‚Äî –º–∞–≥–∏—è –∏ –º—É–¥—Ä–æ—Å—Ç—å —Ä–µ—à–∞—é—Ç –∑–∞–≥–∞–¥–∫–∏            ‚ïë
‚ïë     ‚Ä¢ –°–ª—É–≥–∞ ‚Äî –ø–µ—Ä—Å—Ç–µ–Ω—å –∏ —Ç–∞–π–Ω—ã–µ —Ç—Ä–æ–ø—ã                       ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
""")
    input("\n  [Enter ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é]")


def select_class() -> str:
    """–í—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
    
    print("\n" + "‚ïê" * 60)
    print("  üé≠ –í–´–ë–û–† –ü–ï–†–°–û–ù–ê–ñ–ê")
    print("‚ïê" * 60)
    
    print("""
    –¢—Ä–∏ –≥–µ—Ä–æ—è. –¢—Ä–∏ —Å—É–¥—å–±—ã. –¢—Ä–∏ –ø—É—Ç–∏ –∫ —Å–æ–∫—Ä–æ–≤–∏—â—É.
    –ö–µ–º —Ç—ã —Å—Ç–∞–Ω–µ—à—å?
""")
    
    print("  1. ü§™ –ò–í–ê–ù-–î–£–†–ê–ö")
    print("     –ú–ª–∞–¥—à–∏–π —Å—ã–Ω. –£–¥–∞—á–∞ –∏ –¥–æ–±—Ä–æ—Ç–∞ ‚Äî –µ–≥–æ –æ—Ä—É–∂–∏–µ.")
    print("     HP: 120 | –°–∏–ª–∞: 14 | –õ–æ–≤–∫–æ—Å—Ç—å: 18")
    
    print("\n  2. ‚ú® –í–ê–°–ò–õ–ò–°–ê –ü–†–ï–ú–£–î–†–ê–Ø")
    print("     –î–æ—á—å –∫–æ–ª–¥—É–Ω–∞. –ò—â–µ—Ç —Å–ø–æ—Å–æ–± —Å–ø–∞—Å—Ç–∏ –æ—Ç—Ü–∞.")
    print("     HP: 100 | MP: 80 | –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: 25")
    
    print("\n  3. üó°Ô∏è –ö–û–©–ï–ï–í –°–õ–£–ì–ê")
    print("     –ë—ã–≤—à–∏–π —Ä–∞–±. –ó–Ω–∞–µ—Ç —Ç–∞–π–Ω—ã–µ –ø—É—Ç–∏ –∫ —Å–≤–æ–±–æ–¥–µ.")
    print("     HP: 110 | –°–∏–ª–∞: 18 | –õ–æ–≤–∫–æ—Å—Ç—å: 15")
    
    print("\n  4. üìñ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤")
    print("  5. ‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    
    while True:
        try:
            choice = int(input("\n  –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (1-5): "))
            
            if choice == 1:
                return "–∏–≤–∞–Ω"
            elif choice == 2:
                return "–≤–∞—Å–∏–ª–∏—Å–∞"
            elif choice == 3:
                return "—Å–ª—É–≥–∞"
            elif choice == 4:
                print(get_class_description("–∏–≤–∞–Ω"))
                input("\n  [Enter ‚Äî –¥–∞–ª–µ–µ]")
                print(get_class_description("–≤–∞—Å–∏–ª–∏—Å–∞"))
                input("\n  [Enter ‚Äî –¥–∞–ª–µ–µ]")
                print(get_class_description("—Å–ª—É–≥–∞"))
                input("\n  [Enter ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–±–æ—Ä—É]")
            elif choice == 5:
                return ""
            else:
                print("  ‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç 1 –¥–æ 5")
        except ValueError:
            print("  ‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")


def show_intro(hero):
    """–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
    
    if isinstance(hero, Ivan):
        print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë               ü§™ –ò–°–¢–û–†–ò–Ø –ò–í–ê–ù–ê-–î–£–†–ê–ö–ê                        ‚ïë
‚ïë                                                              ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                              ‚ïë
‚ïë  –í –¥–µ—Ä–µ–≤–Ω–µ –ú–∞–ª—ã–µ –ü–µ–Ω—å–∫–∏ –∂–∏–ª-–±—ã–ª –ò–≤–∞–Ω ‚Äî –º–ª–∞–¥—à–∏–π —Å—ã–Ω          ‚ïë
‚ïë  –±–µ–¥–Ω–æ–≥–æ –∫—Ä–µ—Å—Ç—å—è–Ω–∏–Ω–∞. –°—Ç–∞—Ä—à–∏–µ –±—Ä–∞—Ç—å—è –∑–≤–∞–ª–∏ –µ–≥–æ –¥—É—Ä–∞–∫–æ–º,     ‚ïë
‚ïë  –∞ –æ–Ω –Ω–µ –æ–±–∏–∂–∞–ª—Å—è ‚Äî —Ç–æ–ª—å–∫–æ —É–ª—ã–±–∞–ª—Å—è –≤ –æ—Ç–≤–µ—Ç.                ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –û–¥–Ω–∞–∂–¥—ã –Ω–∞ —è—Ä–º–∞—Ä–∫–µ —Å—Ç–∞—Ä–∏–∫-—Å—Ç—Ä–∞–Ω–Ω–∏–∫ —Ä–∞—Å—Å–∫–∞–∑–∞–ª –ø—Ä–æ           ‚ïë
‚ïë  –ó–∞–ø–æ–≤–µ–¥–Ω—ã–π –õ–µ—Å, –≥–¥–µ —Å–ø—Ä—è—Ç–∞–Ω–æ –Ω–µ—Å–º–µ—Ç–Ω–æ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ.          ‚ïë
‚ïë  –ë—Ä–∞—Ç—å—è –ø–æ—Å–º–µ—è–ª–∏—Å—å, –∞ –ò–≤–∞–Ω –∑–∞–¥—É–º–∞–ª—Å—è...                     ‚ïë
‚ïë                                                              ‚ïë
‚ïë  ¬´–ü–æ–π–¥—É-–∫–∞ –ø–æ–≥–ª—è–∂—É! –ê–≤–æ—Å—å –ø–æ–≤–µ–∑—ë—Ç!¬ª                         ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –ú–∞—Ç—É—à–∫–∞ –≤—Å–ø–ª–∞–∫–Ω—É–ª–∞, –¥–∞–ª–∞ –≤ –¥–æ—Ä–æ–≥—É –∫—Ä–∞—é—Ö—É —Ö–ª–µ–±–∞             ‚ïë
‚ïë  –∏ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∏–ª–∞ –Ω–∞ –ø—Ä–æ—â–∞–Ω–∏–µ.                                ‚ïë
‚ïë                                                              ‚ïë
‚ïë  ¬´–ò–¥–∏, —Å—ã–Ω–æ–∫. –î–æ–±—Ä—ã–º –ª—é–¥—è–º —É–¥–∞—á–∞ —É–ª—ã–±–∞–µ—Ç—Å—è.¬ª                ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
""")
    
    elif isinstance(hero, Vasilisa):
        print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë             ‚ú® –ò–°–¢–û–†–ò–Ø –í–ê–°–ò–õ–ò–°–´ –ü–†–ï–ú–£–î–†–û–ô                    ‚ïë
‚ïë                                                              ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                              ‚ïë
‚ïë  –í–∞—Å–∏–ª–∏—Å–∞ ‚Äî –¥–æ—á—å –≤–µ–ª–∏–∫–æ–≥–æ –∫–æ–ª–¥—É–Ω–∞ –í–µ–ª–∏–º—É–¥—Ä–∞.                ‚ïë
‚ïë  –î–µ—Å—è—Ç—å –ª–µ—Ç –Ω–∞–∑–∞–¥ –ö–æ—â–µ–π –ë–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–π, –∑–∞–≤–∏–¥—É—è —Å–∏–ª–µ –æ—Ç—Ü–∞,     ‚ïë
‚ïë  –ø—Ä–æ–∫–ª—è–ª –µ–≥–æ, –ø—Ä–µ–≤—Ä–∞—Ç–∏–≤ –≤ –∫–∞–º–µ–Ω–Ω—É—é —Å—Ç–∞—Ç—É—é.                  ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –° —Ç–µ—Ö –ø–æ—Ä –í–∞—Å–∏–ª–∏—Å–∞ –∏—â–µ—Ç —Å–ø–æ—Å–æ–± —Å–Ω—è—Ç—å –ø—Ä–æ–∫–ª—è—Ç–∏–µ.            ‚ïë
‚ïë  –î—Ä–µ–≤–Ω–∏–µ –∫–Ω–∏–≥–∏ –≥–æ–≤–æ—Ä—è—Ç: –≤ –ó–∞–ø–æ–≤–µ–¥–Ω–æ–º –õ–µ—Å—É —Å–ø—Ä—è—Ç–∞–Ω           ‚ïë
‚ïë  –°–≤–∏—Ç–æ–∫ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–∞–¥–µ–∂–¥–∞!                ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –í–∞—Å–∏–ª–∏—Å–∞ –±–µ—Ä—ë—Ç –∑–µ—Ä–∫–∞–ª—å—Ü–µ –º–∞—Ç–µ—Ä–∏, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–¥—É,    ‚ïë
‚ïë  –Ω–∞–¥–µ–≤–∞–µ—Ç –¥–æ—Ä–æ–∂–Ω—ã–π –ø–ª–∞—â –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—É—Ç—å.              ‚ïë
‚ïë                                                              ‚ïë
‚ïë  ¬´–ñ–¥–∏ –º–µ–Ω—è, –æ—Ç–µ—Ü. –Ø —Ç–µ–±—è —Å–ø–∞—Å—É.¬ª                            ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
""")
    
    else:  # –°–ª—É–≥–∞
        print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë               üó°Ô∏è –ò–°–¢–û–†–ò–Ø –ö–û–©–ï–ï–í–ê –°–õ–£–ì–ò                       ‚ïë
‚ïë                                                              ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                              ‚ïë
‚ïë  –ö–æ–≥–¥–∞-—Ç–æ —Ç—ã –±—ã–ª –æ–±—ã—á–Ω—ã–º –≤–æ—Ä–æ–º ‚Äî –ª–æ–≤–∫–∏–º –∏ –¥–µ—Ä–∑–∫–∏–º.          ‚ïë
‚ïë  –ù–æ –æ–¥–Ω–∞–∂–¥—ã –ø–æ–ø–∞–ª—Å—è –Ω–∞ –∫—Ä–∞–∂–µ –≤ –∑–∞–º–∫–µ –ö–æ—â–µ—è...               ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –ë–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–π –ø—Ä–µ–¥–ª–æ–∂–∏–ª –≤—ã–±–æ—Ä: –º—É—á–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ—Ä—Ç—å            ‚ïë
‚ïë  –∏–ª–∏ –≤–µ—á–Ω–∞—è —Å–ª—É–∂–±–∞. –¢—ã –≤—ã–±—Ä–∞–ª –∂–∏–∑–Ω—å.                        ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –î–µ—Å—è—Ç—å –ª–µ—Ç –≤ —Ç–µ–º–Ω–∏—Ü–∞—Ö –∏ –∫–æ—Ä–∏–¥–æ—Ä–∞—Ö –∑–∞–º–∫–∞.                   ‚ïë
‚ïë  –î–µ—Å—è—Ç—å –ª–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–æ–ª—é —Ö–æ–∑—è–∏–Ω–∞.                         ‚ïë
‚ïë  –ü–µ—Ä—Å—Ç–µ–Ω—å –Ω–∞ –ø–∞–ª—å—Ü–µ ‚Äî –∑–Ω–∞–∫ —Ä–∞–±–∞ –∏ –ø—Ä–æ–∫–ª—è—Ç–∏–µ.                ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –ù–æ —Ç—ã —É–∑–Ω–∞–ª —Å–µ–∫—Ä–µ—Ç: –≤ –ó–∞–ø–æ–≤–µ–¥–Ω–æ–º –õ–µ—Å—É –µ—Å—Ç—å —Å–æ–∫—Ä–æ–≤–∏—â–µ,      ‚ïë
‚ïë  —Å–ø–æ—Å–æ–±–Ω–æ–µ –¥–∞—Ç—å —Å–≤–æ–±–æ–¥—É. –ö–æ—â–µ–π —Å–∞–º –±–æ–∏—Ç—Å—è —Ç–æ–≥–æ –º–µ—Å—Ç–∞.       ‚ïë
‚ïë                                                              ‚ïë
‚ïë  –ü–æ—Ä–∞ –±–µ–∂–∞—Ç—å. –ü–æ—Ä–∞ —Å—Ç–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–º.                         ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
""")
    
    input("\n  [Enter ‚Äî –Ω–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ]")


def game_loop(hero) -> str:
    """
    –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "new_game", "main_menu", "quit", "continue"
    """
    
    game_manager.hero = hero
    game_manager.sync_from_hero(hero)
    
    # –ù–∞—á–∞–ª—å–Ω–∞—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è
    current_location = game_manager.current_state.current_location or "opushka"
    
    while True:
        try:
            # –ü–æ–ª—É—á–∞–µ–º –ª–æ–∫–∞—Ü–∏—é
            location = get_location(current_location)
            if not location:
                print(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞: –ª–æ–∫–∞—Ü–∏—è ¬´{current_location}¬ª –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
                current_location = "opushka"
                continue
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            game_manager.current_state.current_location = current_location
            game_manager.sync_from_hero(hero)
            
            # –í—Ö–æ–¥–∏–º –≤ –ª–æ–∫–∞—Ü–∏—é
            result = location.enter(hero)
            
            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏–π –≤ –ª–æ–∫–∞—Ü–∏–∏
            game_manager.sync_from_hero(hero)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if result.game_over:
                # –ü–æ–±–µ–¥–∞ –∏–ª–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ
                action = game_manager.game_over_menu(result.victory, result.path_taken)
                
                if action == "continue":
                    # –ó–∞–≥—Ä—É–∑–∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª
                    current_location = game_manager.current_state.current_location
                    game_manager.sync_to_hero(hero)
                    continue
                elif action == "new_game":
                    return "new_game"
                elif action == "main_menu":
                    return "main_menu"
                else:
                    return "quit"
            
            # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
            if result.reload_location:
                current_location = game_manager.current_state.current_location
                game_manager.sync_to_hero(hero)
                continue
            
            # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
            if result.next_location:
                current_location = result.next_location
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π ‚Äî –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ –º–µ—Å—Ç–µ –∏–ª–∏ –∏–¥—ë–º –Ω–∞ —Ä–∞–∑–≤–∏–ª–∫—É
                current_location = "opushka"
        
        except SystemExit as e:
            if str(e) == "menu_exit":
                # –í—ã—Ö–æ–¥ —á–µ—Ä–µ–∑ –º–µ–Ω—é
                return "main_menu"
            raise
        
        except KeyboardInterrupt:
            print("\n\n  ‚ö†Ô∏è –ò–≥—Ä–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞!")
            if game_manager.can_save():
                print("  üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å? (y/n)")
                try:
                    if input("  ").lower() == 'y':
                        game_manager.save_game()
                        print("  ‚úÖ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!")
                except (KeyboardInterrupt, EOFError):
                    pass
            return "main_menu"


def continue_game() -> str:
    """–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∏–≥—Ä—É."""
    
    if not game_manager.load_game():
        print("  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!")
        input("\n  [Enter ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è]")
        return "main_menu"
    
    state = game_manager.current_state
    if not state or not state.class_id:
        print("  ‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–æ!")
        input("\n  [Enter ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è]")
        return "main_menu"
    
    # –°–æ–∑–¥–∞—ë–º –≥–µ—Ä–æ—è –Ω—É–∂–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
    hero = create_hero(state.class_id)
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ –Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    game_manager.sync_to_hero(hero)
    
    print(f"\n  ‚úÖ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!")
    print(f"\n  {hero.CLASS_ICON} {hero.name}")
    print(f"  ‚ù§Ô∏è HP: {hero.hp}/{hero.max_hp}")
    if hasattr(hero, 'mp'):
        print(f"  üíô MP: {hero.mp}/{hero.max_mp}")
    print(f"  üìç –õ–æ–∫–∞—Ü–∏—è: {state.current_location}")
    print(f"  üîë –ö–ª—é—á–µ–π: {hero.count_keys()}/3")
    
    input("\n  [Enter ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ]")
    
    return game_loop(hero)


def new_game() -> str:
    """–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É."""
    
    class_id = select_class()
    if not class_id:
        return "main_menu"
    
    # –°–æ–∑–¥–∞—ë–º –≥–µ—Ä–æ—è
    hero = create_hero(class_id)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    game_manager.new_game(class_id)
    game_manager.sync_from_hero(hero)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ
    show_intro(hero)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    return game_loop(hero)


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞."""
    
    clear_screen()
    show_title()
    
    # –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
    if not login_menu():
        print("\n  üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
        return
    
    # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –º–µ–Ω—é
    while True:
        action = main_menu()
        
        if action == "new":
            result = new_game()
            if result == "quit":
                break
            # –ï—Å–ª–∏ "new_game" ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ü–∏–∫–ª –º–µ–Ω—é
            # –ï—Å–ª–∏ "main_menu" ‚Äî —Ç–æ–∂–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
        
        elif action == "continue":
            result = continue_game()
            if result == "quit":
                break
        
        elif action == "stats":
            game_manager.show_stats()
            input("\n  [Enter ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è]")
        
        elif action == "help":
            show_help()
        
        elif action == "quit":
            break
    
    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
    if game_manager.can_save():
        print("\n  üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º? (y/n)")
        try:
            if input("  ").lower() == 'y':
                game_manager.save_game()
                print("  ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!")
        except (KeyboardInterrupt, EOFError):
            pass
    
    print("\n  üëã –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! –î–æ –Ω–æ–≤—ã—Ö –≤—Å—Ç—Ä–µ—á!")


if __name__ == "__main__":
    main()
